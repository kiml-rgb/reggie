## ç‘å‰å¤–å–é¡¹ç›®ä»‹ç»

### é¡¹ç›®ä»‹ç»

![é¡¹ç›®ç•Œé¢](https://gitee.com/kiml18058625598/reggie/raw/day07/reggie-README/image-20210726000655646.png)

æœ¬é¡¹ç›®ï¼ˆç‘å‰å¤–å–ï¼‰æ˜¯ä¸“é—¨ä¸ºé¤é¥®ä¼ä¸šï¼ˆé¤å…ã€é¥­åº—ï¼‰å®šåˆ¶çš„ä¸€æ¬¾è½¯ä»¶äº§å“ï¼ŒåŒ…æ‹¬ ç³»ç»Ÿç®¡ç†åå° å’Œ ç§»åŠ¨ç«¯åº”ç”¨ ä¸¤éƒ¨åˆ†ã€‚å…¶ä¸­ç³»ç»Ÿç®¡ç†åå°ä¸»è¦æä¾›ç»™é¤é¥®ä¼ä¸šå†…éƒ¨å‘˜å·¥ä½¿ç”¨ï¼Œå¯ä»¥å¯¹é¤å…çš„åˆ†ç±»ã€èœå“ã€å¥—é¤ã€è®¢å•ã€å‘˜å·¥ç­‰è¿›è¡Œç®¡ç†ç»´æŠ¤ã€‚ç§»åŠ¨ç«¯åº”ç”¨ä¸»è¦æä¾›ç»™æ¶ˆè´¹è€…ä½¿ç”¨ï¼Œå¯ä»¥åœ¨çº¿æµè§ˆèœå“ã€æ·»åŠ è´­ç‰©è½¦ã€ä¸‹å•ç­‰ã€‚



æœ¬é¡¹ç›®å…±åˆ†ä¸º3æœŸè¿›è¡Œå¼€å‘ï¼š

| é˜¶æ®µ   | åŠŸèƒ½å®ç°                                                     |
| ------ | ------------------------------------------------------------ |
| ç¬¬ä¸€æœŸ | ä¸»è¦å®ç°åŸºæœ¬éœ€æ±‚ï¼Œå…¶ä¸­ç§»åŠ¨ç«¯åº”ç”¨é€šè¿‡H5å®ç°ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡æ‰‹æœºæµè§ˆå™¨è®¿é—® |
| ç¬¬äºŒæœŸ | ä¸»è¦é’ˆå¯¹ç§»åŠ¨ç«¯åº”ç”¨è¿›è¡Œæ”¹è¿›ï¼Œä½¿ç”¨å¾®ä¿¡å°ç¨‹åºå®ç°ï¼Œç”¨æˆ·ä½¿ç”¨èµ·æ¥æ›´åŠ æ–¹ä¾¿ |
| ç¬¬ä¸‰æœŸ | ä¸»è¦é’ˆå¯¹ç³»ç»Ÿè¿›è¡Œä¼˜åŒ–å‡çº§ï¼Œæé«˜ç³»ç»Ÿçš„è®¿é—®æ€§èƒ½                 |



### äº§å“åŸå‹

**1. ç®¡ç†ç«¯**

é¤é¥®ä¼ä¸šå†…éƒ¨å‘˜å·¥ä½¿ç”¨ã€‚ ä¸»è¦åŠŸèƒ½æœ‰: 

| æ¨¡å—      | æè¿°                                                         |
| --------- | ------------------------------------------------------------ |
| ç™»å½•/é€€å‡º | å†…éƒ¨å‘˜å·¥å¿…é¡»ç™»å½•å,æ‰å¯ä»¥è®¿é—®ç³»ç»Ÿç®¡ç†åå°                    |
| å‘˜å·¥ç®¡ç†  | ç®¡ç†å‘˜å¯ä»¥åœ¨ç³»ç»Ÿåå°å¯¹å‘˜å·¥ä¿¡æ¯è¿›è¡Œç®¡ç†ï¼ŒåŒ…å«æŸ¥è¯¢ã€æ–°å¢ã€ç¼–è¾‘ã€ç¦ç”¨ç­‰åŠŸèƒ½ |
| åˆ†ç±»ç®¡ç†  | ä¸»è¦å¯¹å½“å‰é¤å…ç»è¥çš„ èœå“åˆ†ç±» æˆ– å¥—é¤åˆ†ç±» è¿›è¡Œç®¡ç†ç»´æŠ¤ï¼Œ åŒ…å«æŸ¥è¯¢ã€æ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤ç­‰åŠŸèƒ½ |
| èœå“ç®¡ç†  | ä¸»è¦ç»´æŠ¤å„ä¸ªåˆ†ç±»ä¸‹çš„èœå“ä¿¡æ¯ï¼ŒåŒ…å«æŸ¥è¯¢ã€æ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤ã€å¯å”®ã€åœå”®ç­‰åŠŸèƒ½ |
| å¥—é¤ç®¡ç†  | ä¸»è¦ç»´æŠ¤å½“å‰é¤å…ä¸­çš„å¥—é¤ä¿¡æ¯ï¼ŒåŒ…å«æŸ¥è¯¢ã€æ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤ã€å¯å”®ã€åœå”®ç­‰åŠŸèƒ½ |
| è®¢å•æ˜ç»†  | ä¸»è¦ç»´æŠ¤ç”¨æˆ·åœ¨ç§»åŠ¨ç«¯ä¸‹çš„è®¢å•ä¿¡æ¯ï¼ŒåŒ…å«æŸ¥è¯¢ã€å–æ¶ˆã€æ´¾é€ã€å®Œæˆï¼Œä»¥åŠè®¢å•æŠ¥è¡¨ä¸‹è½½ç­‰åŠŸèƒ½ |

**2. ç”¨æˆ·ç«¯**

ç§»åŠ¨ç«¯åº”ç”¨ä¸»è¦æä¾›ç»™æ¶ˆè´¹è€…ä½¿ç”¨ã€‚ä¸»è¦åŠŸèƒ½æœ‰:

| æ¨¡å—        | æè¿°                                                         |
| ----------- | ------------------------------------------------------------ |
| ç™»å½•/é€€å‡º   | åœ¨ç§»åŠ¨ç«¯, ç”¨æˆ·ä¹Ÿéœ€è¦ç™»å½•åä½¿ç”¨APPè¿›è¡Œç‚¹é¤                    |
| ç‚¹é¤-èœå•   | åœ¨ç‚¹é¤ç•Œé¢éœ€è¦å±•ç¤ºå‡ºèœå“åˆ†ç±»/å¥—é¤åˆ†ç±», å¹¶æ ¹æ®å½“å‰é€‰æ‹©çš„åˆ†ç±»åŠ è½½å…¶ä¸­çš„èœå“ä¿¡æ¯, ä¾›ç”¨æˆ·æŸ¥è¯¢é€‰æ‹© |
| ç‚¹é¤-è´­ç‰©è½¦ | ç”¨æˆ·é€‰ä¸­çš„èœå“å°±ä¼šåŠ å…¥ç”¨æˆ·çš„è´­ç‰©è½¦, ä¸»è¦åŒ…å« æŸ¥è¯¢è´­ç‰©è½¦ã€åŠ å…¥è´­ç‰©è½¦ã€åˆ é™¤è´­ç‰©è½¦ã€æ¸…ç©ºè´­ç‰©è½¦ç­‰åŠŸèƒ½ |
| è®¢å•æ”¯ä»˜    | ç”¨æˆ·é€‰å®Œèœå“/å¥—é¤å, å¯ä»¥å¯¹è´­ç‰©è½¦èœå“è¿›è¡Œç»“ç®—æ”¯ä»˜, è¿™æ—¶å°±éœ€è¦è¿›è¡Œè®¢å•çš„æ”¯ä»˜ |
| ä¸ªäººä¿¡æ¯    | åœ¨ä¸ªäººä¸­å¿ƒé¡µé¢ä¸­ä¼šå±•ç¤ºå½“å‰ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯, ç”¨æˆ·å¯ä»¥ç®¡ç†æ”¶è´§åœ°å€, ä¹Ÿå¯ä»¥æŸ¥è¯¢å†å²è®¢å•æ•°æ® |



### æŠ€æœ¯é€‰å‹

![æŠ€æœ¯é€‰å‹](https://gitee.com/kiml18058625598/reggie/raw/day07/reggie-README/image-20210726005437857.png)

**1. ç”¨æˆ·å±‚**

æœ¬é¡¹ç›®ä¸­åœ¨æ„å»ºç³»ç»Ÿç®¡ç†åå°çš„å‰ç«¯é¡µé¢ï¼Œæˆ‘ä»¬ä¼šç”¨åˆ°H5ã€Vue.jsã€ElementUIç­‰æŠ€æœ¯ã€‚è€Œåœ¨æ„å»ºç§»åŠ¨ç«¯åº”ç”¨æ—¶ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨åˆ°å¾®ä¿¡å°ç¨‹åºã€‚



**2. ç½‘å…³å±‚**

Nginxæ˜¯ä¸€ä¸ªæœåŠ¡å™¨ï¼Œä¸»è¦ç”¨æ¥ä½œä¸ºHttpæœåŠ¡å™¨ï¼Œéƒ¨ç½²é™æ€èµ„æºï¼Œè®¿é—®æ€§èƒ½é«˜ã€‚åœ¨Nginxä¸­è¿˜æœ‰ä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„ä½œç”¨ï¼š åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡ï¼Œ åœ¨è¿›è¡Œé¡¹ç›®éƒ¨ç½²æ—¶ï¼Œè¦å®ç°Tomcatçš„è´Ÿè½½å‡è¡¡ï¼Œå°±å¯ä»¥é€šè¿‡Nginxæ¥å®ç°ã€‚



**3. åº”ç”¨å±‚**

SpringBootï¼š å¿«é€Ÿæ„å»ºSpringé¡¹ç›®, é‡‡ç”¨ "çº¦å®šä¼˜äºé…ç½®" çš„æ€æƒ³, ç®€åŒ–Springé¡¹ç›®çš„é…ç½®å¼€å‘ã€‚

Spring: ç»Ÿä¸€ç®¡ç†é¡¹ç›®ä¸­çš„å„ç§èµ„æº(bean), åœ¨webå¼€å‘çš„å„å±‚ä¸­éƒ½ä¼šç”¨åˆ°ã€‚

SpringMVCï¼šSpringMVCæ˜¯springæ¡†æ¶çš„ä¸€ä¸ªæ¨¡å—ï¼Œspringmvcå’Œspringæ— éœ€é€šè¿‡ä¸­é—´æ•´åˆå±‚è¿›è¡Œæ•´åˆï¼Œå¯ä»¥æ— ç¼é›†æˆã€‚

SpringSession: ä¸»è¦è§£å†³åœ¨é›†ç¾¤ç¯å¢ƒä¸‹çš„Sessionå…±äº«é—®é¢˜ã€‚

lombokï¼šèƒ½ä»¥ç®€å•çš„æ³¨è§£å½¢å¼æ¥ç®€åŒ–javaä»£ç ï¼Œæé«˜å¼€å‘äººå‘˜çš„å¼€å‘æ•ˆç‡ã€‚ä¾‹å¦‚å¼€å‘ä¸­ç»å¸¸éœ€è¦å†™çš„javabeanï¼Œéƒ½éœ€è¦èŠ±æ—¶é—´å»æ·»åŠ ç›¸åº”çš„getter/setterï¼Œä¹Ÿè®¸è¿˜è¦å»å†™æ„é€ å™¨ã€equalsç­‰æ–¹æ³•ã€‚

Swaggerï¼š å¯ä»¥è‡ªåŠ¨çš„å¸®åŠ©å¼€å‘äººå‘˜ç”Ÿæˆæ¥å£æ–‡æ¡£ï¼Œå¹¶å¯¹æ¥å£è¿›è¡Œæµ‹è¯•ã€‚



**4. æ•°æ®å±‚**

MySQLï¼š å…³ç³»å‹æ•°æ®åº“, æœ¬é¡¹ç›®çš„æ ¸å¿ƒä¸šåŠ¡æ•°æ®éƒ½ä¼šé‡‡ç”¨MySQLè¿›è¡Œå­˜å‚¨ã€‚

MybatisPlusï¼š æœ¬é¡¹ç›®æŒä¹…å±‚å°†ä¼šä½¿ç”¨MybatisPlusæ¥ç®€åŒ–å¼€å‘, åŸºæœ¬çš„å•è¡¨å¢åˆ æ”¹æŸ¥ç›´æ¥è°ƒç”¨æ¡†æ¶æä¾›çš„æ–¹æ³•å³å¯ã€‚

Redisï¼š åŸºäºkey-valueæ ¼å¼å­˜å‚¨çš„å†…å­˜æ•°æ®åº“, è®¿é—®é€Ÿåº¦å¿«, ç»å¸¸ä½¿ç”¨å®ƒåšç¼“å­˜(é™ä½æ•°æ®åº“è®¿é—®å‹åŠ›, æä¾›è®¿é—®æ•ˆç‡), åœ¨åé¢çš„æ€§èƒ½ä¼˜åŒ–ä¸­ä¼šä½¿ç”¨ã€‚



**5. å·¥å…·**

git: ç‰ˆæœ¬æ§åˆ¶å·¥å…·, åœ¨å›¢é˜Ÿåä½œä¸­, ä½¿ç”¨è¯¥å·¥å…·å¯¹é¡¹ç›®ä¸­çš„ä»£ç è¿›è¡Œç®¡ç†ã€‚

maven: é¡¹ç›®æ„å»ºå·¥å…·ã€‚

junitï¼šå•å…ƒæµ‹è¯•å·¥å…·ï¼Œå¼€å‘äººå‘˜åŠŸèƒ½å®ç°å®Œæ¯•åï¼Œéœ€è¦é€šè¿‡junitå¯¹åŠŸèƒ½è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚



### åŠŸèƒ½æ¶æ„

![åŠŸèƒ½æ¶æ„](https://gitee.com/kiml18058625598/reggie/raw/day07/reggie-README/image-20210726122825225.png)

**1. ç§»åŠ¨ç«¯å‰å°åŠŸèƒ½**

æ‰‹æœºå·ç™»å½• , å¾®ä¿¡ç™»å½• , æ”¶ä»¶äººåœ°å€ç®¡ç† , ç”¨æˆ·å†å²è®¢å•æŸ¥è¯¢ , èœå“è§„æ ¼æŸ¥è¯¢ , è´­ç‰©è½¦åŠŸèƒ½ , ä¸‹å• , åˆ†ç±»åŠèœå“æµè§ˆã€‚

**2. ç³»ç»Ÿç®¡ç†åå°åŠŸèƒ½**

å‘˜å·¥ç™»å½•/é€€å‡º , å‘˜å·¥ä¿¡æ¯ç®¡ç† , åˆ†ç±»ç®¡ç† , èœå“ç®¡ç† , å¥—é¤ç®¡ç† , èœå“å£å‘³ç®¡ç† , è®¢å•ç®¡ç† ã€‚



### è§’è‰²

åœ¨ç‘å‰å¤–å–è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œå­˜åœ¨ä»¥ä¸‹ä¸‰ç§ç”¨æˆ·ï¼Œè¿™ä¸‰ç§ç”¨æˆ·å¯¹åº”ä¸‰ä¸ªè§’è‰²ï¼šåå°ç³»ç»Ÿç®¡ç†å‘˜ã€åå°ç³»ç»Ÿæ™®é€šå‘˜å·¥ã€Cç«¯(ç§»åŠ¨ç«¯)ç”¨æˆ·ã€‚

| è§’è‰²             | æƒé™æ“ä½œ                                                     |
| ---------------- | ------------------------------------------------------------ |
| åå°ç³»ç»Ÿç®¡ç†å‘˜   | ç™»å½•åå°ç®¡ç†ç³»ç»Ÿï¼Œæ‹¥æœ‰åå°ç³»ç»Ÿä¸­çš„æ‰€æœ‰æ“ä½œæƒé™               |
| åå°ç³»ç»Ÿæ™®é€šå‘˜å·¥ | ç™»å½•åå°ç®¡ç†ç³»ç»Ÿï¼Œå¯¹èœå“ã€å¥—é¤ã€è®¢å•ç­‰è¿›è¡Œç®¡ç† (ä¸åŒ…å«å‘˜å·¥ç®¡ç†) |
| Cç«¯ç”¨æˆ·          | ç™»å½•ç§»åŠ¨ç«¯åº”ç”¨ï¼Œå¯ä»¥æµè§ˆèœå“ã€æ·»åŠ è´­ç‰©è½¦ã€è®¾ç½®åœ°å€ã€åœ¨çº¿ä¸‹å•ç­‰ |

------

## å¼€å‘ç¯å¢ƒæ­å»º

### æ•°æ®åº“ç¯å¢ƒæ­å»º

#### åˆ›å»ºæ•°æ®åº“

> æ³¨æ„: æœ¬é¡¹ç›®æ•°æ®åº“çš„å­—ç¬¦ä¸², é€‰æ‹© utf8mb4

æœ¬é¡¹ç›®æ•°æ®åº“sqlè¯­å¥åœ¨é¡¹ç›®æ–‡ä»¶ä¸‹

![reggie.sql](https://gitee.com/kiml18058625598/reggie/raw/day07/reggie-README/image-20220919172356989.png)



#### æ•°æ®è¡¨ä»‹ç»

æœ¬é¡¹ç›®æ¶‰åŠåˆ°çš„æ•°æ®è¡¨å¦‚ä¸‹

| **åºå·** | **è¡¨å**      | **è¯´æ˜**         |
| -------- | ------------- | ---------------- |
| 1        | employee      | å‘˜å·¥è¡¨           |
| 2        | category      | èœå“å’Œå¥—é¤åˆ†ç±»è¡¨ |
| 3        | dish          | èœå“è¡¨           |
| 4        | setmeal       | å¥—é¤è¡¨           |
| 5        | setmeal_dish  | å¥—é¤èœå“å…³ç³»è¡¨   |
| 6        | dish_flavor   | èœå“å£å‘³å…³ç³»è¡¨   |
| 7        | user          | ç”¨æˆ·è¡¨ï¼ˆCç«¯ï¼‰    |
| 8        | address_book  | åœ°å€ç°¿è¡¨         |
| 9        | shopping_cart | è´­ç‰©è½¦è¡¨         |
| 10       | orders        | è®¢å•è¡¨           |
| 11       | order_detail  | è®¢å•æ˜ç»†è¡¨       |



### Mavené¡¹ç›®æ­å»º

#### åˆ›å»ºmavené¡¹ç›®

1. åœ¨ideaä¸­åˆ›å»ºmaven project
2. æ£€æŸ¥é¡¹ç›®ç¼–ç ï¼ˆè®¾ç½®å‡ä¸ºUTF-8ï¼‰
3. æ£€æŸ¥mavené…ç½®
4. æ£€æŸ¥JDKç‰ˆæœ¬ï¼ˆJDKçš„ç‰ˆæœ¬é€‰æ‹©1.8ï¼‰



#### æ­å»ºåŸºç¡€ç¯å¢ƒ

1. åœ¨`pom.xml`ä¸­å¯¼å…¥ä¾èµ–
2. åœ¨å·¥ç¨‹çš„resourcesç›®å½•ä¸‹åˆ›å»º`application.yml`æ–‡ä»¶,å¹¶å¼•å…¥é…ç½®
3. ç¼–å†™å¯åŠ¨ç±»`App.class`

```java
@SpringBootApplication
@MapperScan("com.itheima.mapper")
@EnableTransactionManagement
@Slf4j
public class App {
    public static void main(String[] args) {
        SpringApplication.run(App.class, args);
        log.info("é¡¹ç›®å¯åŠ¨æˆåŠŸ...");
    }

    @Bean
    public MybatisPlusInterceptor mybatisPlusInterceptor() {
        MybatisPlusInterceptor mybatisPlusInterceptor = new MybatisPlusInterceptor();
        mybatisPlusInterceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.MYSQL));
        return mybatisPlusInterceptor;
    }
}
```

> @Slf4j : 
>
> æ˜¯lombokä¸­æä¾›çš„æ³¨è§£, ç”¨æ¥é€šè¿‡slf4jè®°å½•æ—¥å¿—ã€‚

å½“æ­å»ºå®Œä¸Šè¿°çš„åŸºç¡€ç¯å¢ƒä¹‹å, å°±å¯ä»¥é€šè¿‡å¼•å¯¼ç±», å¯åŠ¨è¯¥é¡¹ç›®ã€‚



#### å‰ç«¯é™æ€èµ„æºå¯¼å…¥

æœ¬é¡¹ç›®çš„å‰ç«¯ä»£ç å·²ç»æä¾›ï¼Œä¸éœ€è¦ç¼–å†™ï¼Œåªè¦èƒ½çœ‹æ‡‚å³å¯ï¼Œåç»­éœ€è¦æŸ¥çœ‹å‰ç«¯éœ€è¦çš„æ•°æ®ï¼Œå®šä¹‰ä¸€äº›æ•°æ®ã€‚

![å‰ç«¯é™æ€èµ„æº](https://gitee.com/kiml18058625598/reggie/raw/day07/reggie-README/image-20220919174107850.png)

ç›´æ¥å°†é™æ€èµ„æºbacakendå’Œfrontæ–‡ä»¶æ”¾åˆ°staticç›®å½•æ–‡ä»¶ä¸‹

Spring Boot é»˜è®¤å°±é…ç½®äº†`/static/**`æ˜ å°„ï¼Œæ‰€ä»¥æ— éœ€ä»»ä½•é…ç½®å°±èƒ½è®¿é—®æ­¤ç›®å½•ä¸‹çš„é™æ€èµ„æº

> åœ¨Springbooté¡¹ç›®ä¸­, é»˜è®¤é™æ€èµ„æºçš„å­˜æ”¾ç›®å½•ä¸º : "classpath:/resources/", "classpath:/static/", "classpath:/public/"

å¦‚æœä¸å°†æ–‡ä»¶å­˜æ”¾åœ¨springbooté»˜è®¤é…ç½®çš„åŠ è½½ç›®å½•ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™æƒ³è¦è®¿é—®åˆ°é™æ€èµ„æºï¼Œå°±è¦è®¾ç½®é™æ€èµ„æºæ˜ å°„ã€‚

```java
import lombok.extern.slf4j.Slf4j;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurationSupport;

@Slf4j
@Configuration
public class WebMvcConfig extends WebMvcConfigurationSupport {
    /**
     * è®¾ç½®é™æ€èµ„æºæ˜ å°„
     * @param registry
     */
    @Override
    protected void addResourceHandlers(ResourceHandlerRegistry registry) {
        log.info("å¼€å§‹è¿›è¡Œé™æ€èµ„æºæ˜ å°„...");
        registry.addResourceHandler("/backend/**").addResourceLocations("classpath:/backend/");
        registry.addResourceHandler("/front/**").addResourceLocations("classpath:/front/");
    }
}
```



### åŸºç¡€ç±»å¯¼å…¥

#### å®ä½“ç±»å¯¼å…¥

åˆ›å»ºå®ä½“ç±»åŒ…ï¼Œå°†æ‰€æœ‰å®ä½“ç±»ç›´æ¥å¯¼å…¥

![å®ä½“ç±»](https://gitee.com/kiml18058625598/reggie/raw/day07/reggie-README/image-20220920090521628.png)



#### voå’Œdtoå¯¼å…¥

![voå’Œdto](https://gitee.com/kiml18058625598/reggie/raw/day07/reggie-README/image-20220920101609748.png)

> VOï¼ˆView Objectï¼‰ï¼šè§†å›¾å¯¹è±¡ï¼Œç”¨äºå±•ç¤ºå±‚ï¼Œå®ƒçš„ä½œç”¨æ˜¯æŠŠæŸä¸ªæŒ‡å®šé¡µé¢ï¼ˆæˆ–ç»„ä»¶ï¼‰çš„æ‰€æœ‰æ•°æ®å°è£…èµ·æ¥ã€‚é€šå¸¸èµ·çš„ç±»åä¼šåŠ ä¸ŠVOã€‚
>
> DTOï¼ˆData Transfer Objectï¼‰ï¼šæ³›æŒ‡ç”¨äºå±•ç¤ºå±‚ä¸æœåŠ¡å±‚ä¹‹é—´çš„æ•°æ®ä¼ è¾“å¯¹è±¡ã€‚ç”¨äºControllerä¸­æ¥æ”¶çš„å‚æ•°è¾ƒå¤šæ—¶ï¼Œå®šä¹‰ä¸€ä¸ªå¯¹è±¡ä¸“é—¨ç”¨äºæ¥æ”¶è¿™äº›å¯¹è±¡ã€‚

------

## ä¸šåŠ¡é€»è¾‘

### åå°ç³»ç»Ÿç™»å½•

1. åˆ¤æ–­ä¼ å…¥çš„å‚æ•°æ˜¯å¦åˆæ³•
2. åˆ¤æ–­ç”¨æˆ·åæˆ–å¯†ç æ˜¯å¦ä¸ºç©º
3. æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ä¸€ä¸ªEmpå¯¹è±¡
4. åˆ¤æ–­ç”¨æˆ·åå¯¹åº”çš„ç”¨æˆ·æ˜¯å¦å­˜åœ¨
5. å¯¹è¾“å…¥çš„å¯†ç è¿›è¡ŒMD5åŠ å¯†
6. å°†åŠ å¯†åçš„å¯†ç ä¸æ•°æ®åº“ä¸­æŸ¥è¯¢åˆ°çš„è¿›è¡Œæ¯”è¾ƒ
7. è¿”å›ç™»é™†æˆåŠŸæ•°æ®

```java
/**
 * å‘˜å·¥ç™»é™†ä¸šåŠ¡
 * @param employee å‘˜å·¥
 * @return R
 */
@Override
public R login(Employee employee) {
    // åˆ¤æ–­ä¼ å…¥çš„å‚æ•°æ˜¯å¦åˆæ³•
    if (ObjectUtil.isNull(employee)) return R.error("å‚æ•°ä¸åˆæ³•");

    // åˆ¤æ–­ç”¨æˆ·åæˆ–å¯†ç æ˜¯å¦ä¸ºç©º
    if (StrUtil.hasEmpty(employee.getUsername(), employee.getPassword())) return R.error("ç”¨æˆ·åæˆ–å¯†ç ä¸èƒ½ä¸ºç©º");

    // æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ä¸€ä¸ªEmpå¯¹è±¡
    Employee one = this.getOne(Wrappers.lambdaQuery(Employee.class)
            .eq(Employee::getUsername, employee.getUsername()));

    // åˆ¤æ–­ç”¨æˆ·åå¯¹åº”çš„ç”¨æˆ·æ˜¯å¦å­˜åœ¨
    if (ObjectUtil.isNull(one)) return R.error("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");

    // å¯¹è¾“å…¥çš„å¯†ç è¿›è¡ŒMD5åŠ å¯†
    String md5 = SecureUtil.md5(employee.getPassword());
    // å°†åŠ å¯†åçš„å¯†ç ä¸æ•°æ®åº“ä¸­æŸ¥è¯¢åˆ°çš„è¿›è¡Œæ¯”è¾ƒ
    if (!StrUtil.equals(md5, one.getPassword(), true)) return R.error("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");

    // è¿”å›ç™»é™†æˆåŠŸæ•°æ®
    return R.success(one);
}
```



### æ–°å¢å‘˜å·¥åŠŸèƒ½

1. åˆ¤æ–­ä¼ å…¥çš„å‚æ•°æ˜¯å¦åˆæ³•
2. åˆ¤æ–­æ‰‹æœºå·ç æ ¼å¼
3. åˆ¤æ–­èº«ä»½è¯å·ç æ ¼å¼
4. åˆ¤æ–­ç”¨æˆ·åæ˜¯å¦è¢«å ç”¨
5. è®¾ç½®åˆå§‹å¯†ç 123456ï¼Œä½¿ç”¨MD5åŠ å¯†
6. è®¾ç½®æ›´æ–°æ—¶é—´å’Œæ–°å»ºæ—¶é—´ï¼Œæ­¤å¤„ä½¿ç”¨Mybatis Plusçš„è‡ªåŠ¨å¡«å……

```java
@Override
public R addEmployee(Employee employee) {
    // åˆ¤æ–­ä¼ å…¥çš„å‚æ•°æ˜¯å¦åˆæ³•
    if (ObjectUtil.isNull(employee)) return R.error("å‚æ•°ä¸åˆæ³•");

    if (ObjectUtil.hasEmpty(employee.getName(), employee.getUsername(), employee.getPhone(),
            employee.getIdNumber())) return R.error("å‚æ•°ä¸åˆæ³•");

    // åˆ¤æ–­æ‰‹æœºå·ç æ ¼å¼
    if (!PhoneUtil.isMobile(employee.getPhone())) return R.error("æ‰‹æœºå·ç æ ¼å¼ä¸æ­£ç¡®");

    // åˆ¤æ–­èº«ä»½è¯å·ç æ ¼å¼
    if (!IdcardUtil.isValidCard(employee.getIdNumber())) return R.error("èº«ä»½è¯å·ç æ ¼å¼ä¸æ­£ç¡®");

    // åˆ¤æ–­ç”¨æˆ·åæ˜¯å¦è¢«å ç”¨
    Employee one = this.getOne(Wrappers.lambdaQuery(Employee.class).eq(Employee::getUsername, employee.getUsername()));
    if (ObjectUtil.isNotNull(one)) return R.error("ç”¨æˆ·åå·²è¢«å ç”¨");

    // è®¾ç½®åˆå§‹å¯†ç 123456 ä½¿ç”¨MD5åŠ å¯†
    employee.setPassword(SecureUtil.md5("123456"));

    // è‡ªåŠ¨å¡«å……ä»£æ›¿
    // employee.setCreateTime(LocalDateTime.now());
    // employee.setUpdateTime(LocalDateTime.now());
    // employee.setCreateUser(EmpThreadLocal.get().getId());
    // employee.setUpdateUser(EmpThreadLocal.get().getId());

    if (this.save(employee)) {
        return R.builder().code(1).msg("æ·»åŠ æˆåŠŸ").data("æ·»åŠ æˆåŠŸ").build();
    }

    return R.error("æ·»åŠ å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•");
}
```

#### æ ¼å¼åˆ¤æ–­-å·¥å…·åŒ…çš„ä½¿ç”¨

æ­¤å¤„å‚æ•°æ ¡éªŒçš„æ—¶å€™ï¼Œéœ€è¦å¤šå¤„æ ¡éªŒæ‰‹æœºå·ï¼Œèº«ä»½è¯ç­‰æ˜¯å¦åˆæ³•ã€‚å½“ç„¶å¯ä»¥è‡ªå®šä¹‰æ­£åˆ™æ ¡éªŒå®Œæˆï¼Œä½†æ˜¯æä¾›ç›¸åº”åŠŸèƒ½çš„å·¥å…·åŒ…æœ‰å¾ˆå¤šï¼ˆèƒ½å·æ‡’è°è‡ªå·±å†™å•ŠğŸ¥±ï¼‰ï¼Œæ­¤å¤„ä½¿ç”¨çš„æ˜¯hutoolå·¥å…·åŒ…ï¼Œåªéœ€è¦åœ¨pom.xmlä¸­æ·»åŠ ä¾èµ–å°±è¡Œã€‚



### ä¿®æ”¹æ—¶åˆ¤æ–­ç”¨æˆ·åé‡å¤

1. é€šè¿‡idæ‰¾åˆ°æ•°æ®åº“ä¸­çš„å¯¹è±¡
2. åˆ¤æ–­æ•°æ®åº“ä¸­çš„å¯¹è±¡çš„åå­—ä¸å½“å‰ä¼ å…¥å¯¹è±¡çš„åå­—æ˜¯å¦ç›¸åŒ
3. å¦‚æœä¸åŒï¼Œè¯´æ˜ä¿®æ”¹äº†ç”¨æˆ·åï¼Œåˆ™éœ€è¦åˆ¤æ–­ä¿®æ”¹åçš„ç”¨æˆ·ååœ¨æ•°æ®åº“ä¸­æ˜¯å¦æœ‰é‡åå¯¹è±¡

```java
Employee oldEmp = this.getById(employee);
if (!StrUtil.equals(oldEmp.getUsername(), employee.getUsername())) {
    Employee one = this.getOne(Wrappers.lambdaQuery(Employee.class).eq(Employee::getUsername, employee.getUsername()));
    // å¦‚æœä¸šåŠ¡å…è®¸ä¿®æ”¹ç”¨æˆ·åï¼Œå¾—å…ˆåˆ¤æ–­ç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·åæ˜¯å¦å’Œä¹‹å‰ä¸€æ ·
    if (ObjectUtil.isNotNull(one)) return R.error("ç”¨æˆ·åå·²è¢«å ç”¨");
}
```



### æ–‡ä»¶çš„ä¸Šä¼ å’Œä¸‹è½½

åœ¨æ·»åŠ èœå“æ—¶ï¼Œæ¶‰åŠåˆ°å›¾ç‰‡çš„ä¸Šä¼ æ“ä½œï¼Œä»¥ä¸‹æ˜¯ä¸€èˆ¬æµç¨‹

æ–‡ä»¶ä¸Šä¼ å‰çš„å¿…é¡»æ“ä½œ

1. æ ¡éªŒ

   æ ¡éªŒæ–‡ä»¶æ˜¯å¦ä¸ºç©º

   æ ¡éªŒæ–‡ä»¶çš„æ ¼å¼

   æ ¡éªŒæ–‡ä»¶çš„å¤§å°

2. ç»™æ–‡ä»¶è¿›è¡Œé‡å‘½å

3. ç»™æ–‡ä»¶ç›®å½•åˆ†ç¦»

   ä½¿ç”¨ç›®å½•åˆ†ç¦»ç®—æ³•(Hash æŠŠhashå€¼ä½œä¸ºç›®å½•åç§°)

   æŒ‰ç…§æ—¥æœŸåˆ†ç›®å½•(æ¯å¤©åˆ›å»ºä¸€ä¸ªæ–°çš„ç›®å½•)

   æŒ‰ç…§ç”¨æˆ·ååˆ†ç›®å½•

4. å›¾ç‰‡ä¿å­˜åœ°ç‚¹

   webæœåŠ¡å™¨ï¼ˆé¡¹ç›®æ‰€è¿è¡Œåœ¨çš„ç”µè„‘ï¼‰ 

   äº‘å­˜å‚¨æœåŠ¡å•†

   è‡ªå·±æ­å»ºæ–‡ä»¶æœåŠ¡å™¨ï¼ˆFastDIS Minioï¼‰

```java
package com.itheima.controller;

import cn.hutool.core.io.FileUtil;
import cn.hutool.core.lang.UUID;
import cn.hutool.core.util.ObjectUtil;
import cn.hutool.core.util.StrUtil;
import com.itheima.vo.R;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.multipart.MultipartFile;

import javax.servlet.ServletOutputStream;
import javax.servlet.http.HttpServletResponse;
import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;

/**
 * @author zyf
 * @program: reggie_take_out
 * @description:
 * @date 2022-09-16 11:38:44
 */
@RestController
@RequestMapping("common")
public class CommonController {

    @PostMapping("upload")
    public R uploadPic(MultipartFile file) throws IOException {
        // æ ¡éªŒ
        // æ ¡éªŒæ–‡ä»¶æ˜¯å¦ä¸ºç©º
        if (ObjectUtil.isNull(file)) return R.error("ä¸Šä¼ æ–‡ä»¶ä¸èƒ½ä¸ºç©º");
        // æ ¡éªŒæ–‡ä»¶çš„æ ¼å¼
        if (!StrUtil.containsAnyIgnoreCase(FileUtil.getSuffix(file.getOriginalFilename()), "jpg", "png")) {
            return R.error("ä¸Šä¼ æ–‡ä»¶æ ¼å¼é”™è¯¯");
        }
        // æ ¡éªŒæ–‡ä»¶çš„å¤§å°
        if (file.getSize() / 1024 / 1024 > 2) return R.error("æ–‡ä»¶è¿‡å¤§ï¼Œé™åˆ¶åœ¨2MBä»¥å†…");
        // ç»™æ–‡ä»¶è¿›è¡Œé‡å‘½å
        String fileName = UUID.fastUUID().toString() + "." + FileUtil.getSuffix(file.getOriginalFilename());
        // ç»™æ–‡ä»¶ç›®å½•åˆ†ç¦»
        // å›¾ç‰‡ä¿å­˜åœ°ç‚¹ webæœåŠ¡å™¨ï¼ˆé¡¹ç›®æ‰€è¿è¡Œåœ¨çš„ç”µè„‘ï¼‰ äº‘å­˜å‚¨æœåŠ¡å•† è‡ªå·±æ­å»ºæ–‡ä»¶æœåŠ¡å™¨ï¼ˆFastDIS Minioï¼‰

        /* å¦‚æœæˆ‘ä»¬æŠŠå›¾ç‰‡ä¿å­˜åˆ°å½“å‰ç”µè„‘çš„å…¶ä»–ç›˜ç¬¦çš„å…¶ä»–ç›®å½•ä¸‹(éé¡¹ç›®çš„staticç›®å½•) */
        /* é‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨ç¼–ç çš„æ–¹å¼å»è¯»å–è¿™ä¸ªæ–‡ä»¶æµ å¹¶ä¸”é€šè¿‡Responseå“åº”è¿™ä¸ªæµ */
        /* ä½†æ˜¯å¦‚æœæˆ‘ä»¬æŠŠå›¾ç‰‡ä¿å­˜åˆ°å½“å‰è¿™ä¸ªé¡¹ç›®çš„staticç›®å½•ä¸­ å°±å¯ä»¥ç›´æ¥è¿”å›ä¸€ä¸ªè®¿é—®è¿™ä¸ªå›¾ç‰‡çš„åœ°å€å­—ç¬¦ä¸² */
        file.transferTo(new File("D:\\Develop\\workspace\\reggie\\reggie_take_out\\src\\main\\resources\\static\\images\\" + fileName));
        return R.success(fileName);
    }

    @GetMapping("download")
    public void downloadPic(String name, HttpServletResponse response) throws IOException {
        FileInputStream fileInputStream = new FileInputStream("D:\\Develop\\workspace\\reggie\\reggie_take_out\\src\\main\\resources\\static\\images\\" + name);
        ServletOutputStream outputStream = response.getOutputStream();

        byte[] bytes = new byte[1024];
        int len = 0;
        while ((len = fileInputStream.read(bytes)) != -1) {
            outputStream.write(bytes, 0, len);
        }

        fileInputStream.close();
        outputStream.close();
    }
}
```

**æ–‡ä»¶ä¸Šä¼ ç›¸å…³ï¼š**

![æ–‡ä»¶ä¸Šä¼ çš„å®ç°æ–¹å¼](https://gitee.com/kiml18058625598/reggie/raw/day07/reggie-README/image-20220920210039909.png)

![æ–‡ä»¶ä¸Šä¼ çš„ä¸‰è¦ç´ ](https://gitee.com/kiml18058625598/reggie/raw/day07/reggie-README/image-20220920210125183.png)

![æ–‡ä»¶ä¸Šä¼ çš„åŸç†](https://gitee.com/kiml18058625598/reggie/raw/day07/reggie-README/image-20220920210202727.png)



### å‘é€çŸ­ä¿¡

å‰å°ç”¨æˆ·é‡‡ç”¨éªŒè¯ç ç™»é™†çš„æ–¹å¼ï¼Œè¿™é‡ŒéªŒè¯ç å‘é€é‡‡ç”¨è¿æ¥é˜¿é‡Œäº‘å®ç°ã€‚

1. é›†æˆé˜¿é‡Œäº‘å¹³å°

   ç”³è¯·ç­¾å

   ç”³è¯·æ¨¡æ¿ ï¼ˆå³çŸ­ä¿¡çš„å†…å®¹ï¼‰ ï¼ˆä¸€ä¸ªç­¾åå¯ä»¥å¯¹åº”å¤šä¸ªæ¨¡æ¿ï¼‰

   é…ç½®AKå’ŒSK ï¼ˆæ¨èä½¿ç”¨å­è´¦æˆ·AKï¼Œé…ç½®æƒé™ï¼‰

1. pom.xmlæ–‡ä»¶ä¸­æ·»åŠ ä¾èµ–

```xml
<!--é˜¿é‡Œäº‘çŸ­ä¿¡å‘é€-->
<dependency>
    <groupId>com.aliyun</groupId>
    <artifactId>aliyun-java-sdk-dysmsapi</artifactId>
    <version>1.1.0</version>
</dependency>
<dependency>
    <groupId>com.aliyun</groupId>
    <artifactId>aliyun-java-sdk-core</artifactId>
    <version>4.6.0</version>
</dependency>
```

2. ç”¨æˆ·ç™»é™†Serviceå±‚ä»£ç å¦‚ä¸‹ï¼š

```java
@Override
public R sendMsg(String phone) {
    if (!PhoneUtil.isMobile(phone)) return R.error("æ‰‹æœºå·ç ä¸åˆæ³•");
    
    // ç”Ÿæˆ6ä½éªŒè¯ç 
    String code = RandomUtil.randomNumbers(6);
    // æµ‹è¯•é€šè¿‡åä¸å†å‘é€éªŒè¯ç ï¼Œé‡‡ç”¨éšæœºç”Ÿæˆæ•°æ®ï¼Œæ§åˆ¶å°è¾“å‡ºçš„æ–¹å¼è¿›è¡Œåç»­æµ‹è¯•ã€‚
    SMSUtils.sendSM(phone,code);
    /*System.out.println("code = " + code);*/
    
    redisTemplate.opsForValue().set(phone + "_CODE", code);
    return R.success(code);
}
```

3. å‘é€éªŒè¯ç çš„SMSUtilsä»£ç å¦‚ä¸‹

```java
package com.itheima.utils;

import com.aliyuncs.DefaultAcsClient;
import com.aliyuncs.IAcsClient;
import com.aliyuncs.dysmsapi.model.v20170525.SendSmsRequest;
import com.aliyuncs.dysmsapi.model.v20170525.SendSmsResponse;
import com.aliyuncs.exceptions.ClientException;
import com.aliyuncs.exceptions.ServerException;
import com.aliyuncs.profile.DefaultProfile;
import com.google.gson.Gson;

import java.io.IOException;
import java.util.Properties;

/**
 * é˜¿é‡Œäº‘çŸ­ä¿¡å‘é€å·¥å…·ç±»
 *
 * @author yunfei
 * @date 2022å¹´09æœˆ17æ—¥ 14:54
 */
public class SMSUtils {

    /* DIçš„å‰ææ˜¯å½“å‰çš„è¿™ä¸ªBeanè¦åœ¨å®¹å™¨ä¸­ */
    /*@Value("aliyun.sms.ak")
    private String ak;*/

    private static String ak;
    private static String sk;
    private static String signName;
    private static String templateCode;

    /* Javaä¸­é€šå¸¸éƒ½ä¼šä½¿ç”¨ç±»åŠ è½½å»è¯»å–æ–‡ä»¶ */
    static {
        try {
            Properties properties = new Properties();
            properties.load(SMSUtils.class.getClassLoader()
                            .getResourceAsStream("aliyun.properties"));
            ak = properties.getProperty("aliyun.sms.ak");
            sk = properties.getProperty("aliyun.sms.sk");
            signName = properties.getProperty("aliyun.sms.signName");
            templateCode = properties.getProperty("aliyun.sms.templateCode");
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    public static SendSmsResponse sendSM(String phoneNum, String code) {
        // åˆ›å»ºä¸€ä¸ª Aliyun Acs Client, ç”¨äºå‘èµ· OpenAPI è¯·æ±‚
        DefaultProfile profile = DefaultProfile.getProfile("cn-hangzhou", ak, sk);
        IAcsClient client = new DefaultAcsClient(profile);

        // åˆ›å»ºä¸€ä¸ª AssumeRoleRequest å¹¶è®¾ç½®è¯·æ±‚å‚æ•°
        SendSmsRequest request = new SendSmsRequest();
        request.setPhoneNumbers(phoneNum);
        request.setSignName(signName);
        request.setTemplateCode(templateCode);
        request.setTemplateParam("{\"code\":\"" + code + "\"}");
        SendSmsResponse response = null;
        try {
            // å‘èµ·è¯·æ±‚ï¼Œå¹¶å¾—åˆ°response
            response = client.getAcsResponse(request);
            System.out.println(new Gson().toJson(response));
            return response;
        } catch (ServerException e) {
            e.printStackTrace();
        } catch (ClientException e) {
            System.out.println("ErrCode:" + e.getErrCode());
            System.out.println("ErrMsg:" + e.getErrMsg());
            System.out.println("RequestId:" + e.getRequestId());
        }
        return response;
    }
}
```

4. ç”±äºæ­¤å·¥å…·ç±»ä¸æƒ³åªä¾èµ–äºspringbootç¯å¢ƒï¼Œå› æ­¤é‡‡ç”¨è¯»å–propertiesæ–‡ä»¶çš„å½¢å¼åŠ è½½è¿æ¥é˜¿é‡Œäº‘å¿…è¦çš„ä¿¡æ¯ã€‚åœ¨å·¥å…·ç±»ä¸­é‡‡ç”¨é™æ€ä»£ç å—ï¼Œè¯»å–é…ç½®ç±»æ–‡ä»¶ä¸­çš„ä¿¡æ¯ã€‚

```properties
aliyun.sms.ak=LTAI5tHnZ8r3424CCbqFD1xZ
aliyun.sms.sk=bo0835BR3Pn8upjtQ0AcHz9vT4mV9Q
aliyun.sms.signName=\u676D\u5DDE\u9ED1\u9A6C\u4F20\u667A\u5065\u5EB7
aliyun.sms.templateCode=SMS_184110818
```



### æäº¤è®¢å•

æœ¬æ“ä½œæ¶‰åŠçš„è¡¨è¾ƒå¤šï¼Œæ˜¯æœ¬é¡¹ç›®ä¸­ä¸šåŠ¡é€»è¾‘æœ€å¤æ‚çš„ä¸€ä¸ªæ¨¡å—ï¼Œä½†ä¹Ÿå¾ˆç®€å•ã€‚

1. è®¾ç½®è®¢å•é»˜è®¤å‚æ•°
2. è·å–è´­ç‰©è½¦ä¿¡æ¯ï¼Œ==è®¡ç®—è®¢å•æ€»é‡‘é¢==
3. è·å–åœ°å€ç°¿æ”¶è´§äººä¿¡æ¯ï¼Œ è®¾ç½®è®¢å•ä¸­æ”¶è´§äººçš„ä¿¡æ¯
4. å°†è´­ç‰©è½¦ä¿¡æ¯==æ‹·è´==ï¼Œæ’å…¥è®¢å•æ˜ç»†
5. å­˜å‚¨ä¿¡æ¯
6. â—æ¸…ç©ºè´­ç‰©è½¦

```java
    @Override
    @Transactional
    public R submitOrder(Orders orders) {
        if (ObjectUtil.isNull(orders.getAddressBookId())) return R.error("å‚æ•°ä¸åˆæ³•");

        // ä½¿ç”¨é›ªèŠ±ç®—æ³•ç”Ÿæˆä¸€ä¸ªId
        orders.setNumber(StrUtil.toString(IdWorker.getId()));
        // è®¾ç½®è®¢å•çŠ¶æ€ é»˜è®¤æ˜¯4
        orders.setStatus(4);
        orders.setUserId(UserThreadLocal.get().getId());
        orders.setOrderTime(LocalDateTime.now());
        orders.setCheckoutTime(LocalDateTime.now());

        List<ShoppingCart> list = shoppingCartService.list(Wrappers.lambdaQuery(ShoppingCart.class)
                .eq(ShoppingCart::getUserId, UserThreadLocal.get().getId()));

        // è®¢å•æ€»é‡‘é¢
        BigDecimal sum = BigDecimal.ZERO;
        for (ShoppingCart shoppingCart : list) {
            BigDecimal amount = shoppingCart.getAmount().multiply(new BigDecimal(shoppingCart.getNumber()));
            sum = sum.add(amount);
        }

        // è®¾ç½®é‡‘é¢
        orders.setAmount(sum);

        // æŸ¥è¯¢æ”¶è´§äººä¿¡æ¯
        AddressBook addressBook = addressBookService.getById(orders.getAddressBookId());

        orders.setPhone(addressBook.getPhone());
        orders.setAddress(addressBook.getDetail());
        orders.setUserName(UserThreadLocal.get().getName());
        orders.setConsignee(addressBook.getConsignee());

        this.save(orders);

        // è®¢å•æ˜ç»†
        ArrayList<OrderDetail> orderDetails = new ArrayList<>();
        for (ShoppingCart shoppingCart : list) {
            OrderDetail detail = new OrderDetail();
            BeanUtils.copyProperties(shoppingCart, detail, "id");
            detail.setOrderId(orders.getId());
            orderDetails.add(detail);
        }

        orderDetailService.saveBatch(orderDetails);

        // æ¸…ç©ºè´­ç‰©è½¦
        shoppingCartService.remove(Wrappers.lambdaQuery(ShoppingCart.class)
                .eq(ShoppingCart::getUserId, UserThreadLocal.get().getId()));
        return R.success(orders);
    }
```

------

## ä»£ç å¢å¼º

### è‡ªå®šä¹‰æ‹¦æˆªå™¨

1. åˆ›å»ºMVCé…ç½®ç±»

```java
package com.itheima.config;

import com.itheima.interceptor.LoginCheckInterceptor;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.InterceptorRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

/**
 * @author zyf
 * @program: reggie_take_out
 * @description:
 * @date 2022-09-12 11:16:02
 */
@Configuration
public class MVCConfig implements WebMvcConfigurer{
    @Autowired
    private LoginCheckInterceptor loginCheckInterceptor;

    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        // æ³¨å†Œæ‹¦æˆªå™¨ï¼Œ å¯¹ç™»å½•è¿›è¡Œæ‹¦æˆªï¼ŒæŒ‡å®šè¦æ‹¦æˆªçš„è¯·æ±‚ï¼ˆ/**ï¼‰
        registry.addInterceptor(loginCheckInterceptor).addPathPatterns("/**");
    }
}
```

2. åˆ›å»ºç™»å½•æ‹¦æˆªå™¨

```java
package com.itheima.interceptor;

import cn.hutool.core.text.AntPathMatcher;
import cn.hutool.core.util.ObjectUtil;
import cn.hutool.json.JSONUtil;
import com.itheima.domain.Employee;
import com.itheima.domain.User;
import com.itheima.utils.EmpThreadLocal;
import com.itheima.utils.UserThreadLocal;
import com.itheima.vo.R;
import org.springframework.stereotype.Component;
import org.springframework.web.method.HandlerMethod;
import org.springframework.web.servlet.HandlerInterceptor;
import org.springframework.web.servlet.ModelAndView;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * @author zyf
 * @program: reggie_take_out
 * @description:
 * @date 2022-09-12 10:45:58
 */
@Component
public class LoginCheckInterceptor implements HandlerInterceptor {

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        // åˆ¤æ–­æœ¬æ¬¡è¯·æ±‚æ˜¯å¦éœ€è¦æ‹¦æˆª
        if (!(handler instanceof HandlerMethod)) return true;

        if (request.getRequestURI().contains("employee/login")) return true;
        if (request.getRequestURI().contains("user/login")) return true;
        if (request.getRequestURI().contains("user/sendMsg")) return true;

        boolean employee = ObjectUtil.isNotNull(request.getSession().getAttribute("employee"));
        boolean user = ObjectUtil.isNotNull(request.getSession().getAttribute("user"));
        if (employee || user) {
            if (employee) EmpThreadLocal.set((Employee) request.getSession().getAttribute("employee"));
            if (user) UserThreadLocal.set((User) request.getSession().getAttribute("user"));
            return true;
        }

        // è®¾ç½®çŠ¶æ€ç 401
        response.setStatus(401);

        // è®¾ç½®ç¼–ç æ ¼å¼
        response.setContentType("application/json;charset=utf-8");

        response.getWriter().write(JSONUtil.toJsonStr(R.error("ç”¨æˆ·æœªç™»å½•")));

        // åˆ¤æ–­æ˜¯å¦ç™»å½•ï¼Œæ²¡æœ‰ç›´æ¥è¿”å›401
        return false;
    }

    /**
     * è¯·æ±‚å›åˆ°æµè§ˆå™¨ä¹‹å‰æ‰§è¡Œ
     * @param request request
     * @param response response
     * @param handler handler
     * @param modelAndView modelAndView
     * @throws Exception
     */
    @Override
    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {
        UserThreadLocal.remove();
        EmpThreadLocal.remove();
    }
}
```



è‡ªå®šä¹‰æ‹¦æˆªå™¨å®ç°`HandlerInterceptor`ï¼Œåœ¨æ­¤æ¥å£ä¸­æœ‰3ä¸ªå¯ä»¥è¢«é‡å†™çš„æ–¹æ³•ï¼š

`preHandle(HttpServletRequest request, HttpServletResponse response, Object handler)`

> æ‹¦æˆªå¤„ç†ç¨‹åºçš„æ‰§è¡Œã€‚åœ¨ HandlerMapping ç¡®å®šé€‚å½“çš„å¤„ç†ç¨‹åºå¯¹è±¡ä¹‹åï¼Œä½†åœ¨ HandlerAdapter è°ƒç”¨å¤„ç†ç¨‹åºä¹‹å‰è°ƒç”¨ã€‚ DispatcherServlet å¤„ç†æ‰§è¡Œé“¾ä¸­çš„å¤„ç†ç¨‹åºï¼Œè¯¥å¤„ç†ç¨‹åºç”±ä»»æ„æ•°é‡çš„æ‹¦æˆªå™¨ç»„æˆï¼Œå¤„ç†ç¨‹åºæœ¬èº«ä½äºæœ€åã€‚ä½¿ç”¨æ­¤æ–¹æ³•ï¼Œæ¯ä¸ªæ‹¦æˆªå™¨éƒ½å¯ä»¥å†³å®šä¸­æ­¢æ‰§è¡Œé“¾ï¼Œé€šå¸¸æ˜¯å‘é€ HTTP é”™è¯¯æˆ–ç¼–å†™è‡ªå®šä¹‰å“åº”ã€‚æ³¨æ„ï¼šç‰¹æ®Šæ³¨æ„äº‹é¡¹é€‚ç”¨äºå¼‚æ­¥è¯·æ±‚å¤„ç†ã€‚

è°ƒç”¨æ—¶é—´ï¼šControlleræ–¹æ³•å¤„ç†ä¹‹å‰

æ‰§è¡Œé¡ºåºï¼šé“¾å¼Intercepteræƒ…å†µä¸‹ï¼ŒIntercepteræŒ‰ç…§å£°æ˜çš„é¡ºåºä¸€ä¸ªæ¥ä¸€ä¸ªæ‰§è¡Œ

è‹¥è¿”å›falseï¼Œåˆ™ä¸­æ–­æ‰§è¡Œï¼Œ**æ³¨æ„ï¼šä¸ä¼šè¿›å…¥afterCompletion**



`postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, @Nullable ModelAndView modelAndView)`

> æ‹¦æˆªå¤„ç†ç¨‹åºçš„æ‰§è¡Œã€‚åœ¨ HandlerAdapter å®é™…è°ƒç”¨å¤„ç†ç¨‹åºä¹‹åï¼Œä½†åœ¨ DispatcherServlet å‘ˆç°è§†å›¾ä¹‹å‰è°ƒç”¨ã€‚å¯ä»¥é€šè¿‡ç»™å®šçš„ ModelAndView å‘è§†å›¾å…¬å¼€å…¶ä»–æ¨¡å‹å¯¹è±¡ã€‚ DispatcherServlet å¤„ç†æ‰§è¡Œé“¾ä¸­çš„å¤„ç†ç¨‹åºï¼Œè¯¥å¤„ç†ç¨‹åºç”±ä»»æ„æ•°é‡çš„æ‹¦æˆªå™¨ç»„æˆï¼Œå¤„ç†ç¨‹åºæœ¬èº«ä½äºæœ€åã€‚ä½¿ç”¨æ­¤æ–¹æ³•ï¼Œæ¯ä¸ªæ‹¦æˆªå™¨éƒ½å¯ä»¥å¯¹æ‰§è¡Œè¿›è¡Œåå¤„ç†ï¼Œä»¥æ‰§è¡Œé“¾çš„ç›¸åé¡ºåºåº”ç”¨ã€‚

è°ƒç”¨å‰æï¼špreHandleè¿”å›true

è°ƒç”¨æ—¶é—´ï¼šControlleræ–¹æ³•å¤„ç†å®Œä¹‹åï¼ŒDispatcherServletè¿›è¡Œè§†å›¾çš„æ¸²æŸ“ä¹‹å‰ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ä½ å¯ä»¥å¯¹ModelAndViewè¿›è¡Œæ“ä½œ

æ‰§è¡Œé¡ºåºï¼šé“¾å¼Intercepteræƒ…å†µä¸‹ï¼ŒIntercepter**æŒ‰ç…§å£°æ˜çš„é¡ºåºå€’ç€æ‰§è¡Œ**ã€‚

å¤‡æ³¨ï¼špostHandleè™½ç„¶postæ‰“å¤´ï¼Œä½†postã€getæ–¹æ³•éƒ½èƒ½å¤„ç†



`afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, @Nullable Exception ex)`

> è¯·æ±‚å¤„ç†å®Œæˆåçš„å›è°ƒï¼Œå³æ¸²æŸ“è§†å›¾åã€‚å°†åœ¨å¤„ç†ç¨‹åºæ‰§è¡Œçš„ä»»ä½•ç»“æœä¸Šè°ƒç”¨ï¼Œä»è€Œå…è®¸é€‚å½“çš„èµ„æºæ¸…ç†ã€‚æ³¨æ„ï¼šä»…å½“æ­¤æ‹¦æˆªå™¨çš„ preHandle æ–¹æ³•å·²æˆåŠŸå®Œæˆå¹¶è¿”å› true æ—¶æ‰ä¼šè°ƒç”¨ï¼ä¸ postHandle æ–¹æ³•ä¸€æ ·ï¼Œè¯¥æ–¹æ³•å°†åœ¨é“¾ä¸­çš„æ¯ä¸ªæ‹¦æˆªå™¨ä¸Šä»¥ç›¸åçš„é¡ºåºè°ƒç”¨ï¼Œå› æ­¤ç¬¬ä¸€ä¸ªæ‹¦æˆªå™¨å°†æ˜¯æœ€åä¸€ä¸ªè¢«è°ƒç”¨çš„æ‹¦æˆªå™¨ã€‚

è°ƒç”¨å‰æï¼špreHandleè¿”å›true

è°ƒç”¨æ—¶é—´ï¼šDispatcherServletè¿›è¡Œè§†å›¾çš„æ¸²æŸ“ä¹‹å

å¤šç”¨äºæ¸…ç†èµ„æº



### ThreadLocal

> åœ¨Javaçš„å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œä¸ºä¿è¯å¤šä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„å®‰å…¨è®¿é—®ï¼Œé€šå¸¸ä¼šä½¿ç”¨synchronizedæ¥ä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡è¿›è¡Œæ“ä½œã€‚è¿™ç§æƒ…å†µä¸‹å¯ä»¥å°†[ç±»å˜é‡](https://baike.baidu.com/item/%E7%B1%BB%E5%8F%98%E9%87%8F)æ”¾åˆ°ThreadLocalç±»å‹çš„å¯¹è±¡ä¸­ï¼Œä½¿å˜é‡åœ¨æ¯ä¸ªçº¿ç¨‹ä¸­éƒ½æœ‰ç‹¬ç«‹æ‹·è´ï¼Œä¸ä¼šå‡ºç°ä¸€ä¸ªçº¿ç¨‹è¯»å–å˜é‡æ—¶è€Œè¢«å¦ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹çš„ç°è±¡ã€‚æœ€å¸¸è§çš„ThreadLocalä½¿ç”¨åœºæ™¯ä¸ºç”¨æ¥è§£å†³æ•°æ®åº“è¿æ¥ã€Sessionç®¡ç†ç­‰ã€‚åœ¨æœ¬é¡¹ç›®ä¸­ï¼Œè¢«ç”¨äºSessionç®¡ç†ã€‚

åœ¨æ‹¦æˆªå™¨çš„ä»£ç ä¸­ï¼Œä½¿ç”¨äº†ä¸¤ä¸ªThreadLocalï¼Œåœ¨ç™»å½•æˆåŠŸåï¼Œå°†ç”¨æˆ·æ•°æ®å­˜å…¥Sessionï¼Œæ¯æ¬¡è¯·æ±‚åœ¨æ‹¦æˆªå™¨ä¸­å°†Sessionä¸­çš„æ•°æ®å­˜åˆ°å¯¹åº”çš„ThreadLocalä¸­ï¼Œæ–¹ä¾¿åç»­çº¿ç¨‹ä½¿ç”¨ã€‚è‡ªå®šä¹‰ThreadLocalçš„ä»£ç å¦‚ä¸‹ï¼š

```java
package com.itheima.utils;

import com.itheima.domain.Employee;

/**
 * @author zyf
 * @program: reggie_take_out
 * @description:
 * @date 2022-09-12 14:49:07
 */
public class EmpThreadLocal {
    private static final ThreadLocal<Employee> tl = new ThreadLocal<>();

    // ä¼ é€’ä¸€ä¸ªEmployeeå¯¹è±¡ï¼ŒæŠŠå¯¹è±¡ç»‘å®šåˆ°çº¿ç¨‹
    public static void set(Employee employee) {
        tl.set(employee);
    }

    // ä»å½“å‰çº¿ç¨‹ä¸Šè·å–ç»‘å®šEMPçš„å¯¹è±¡
    public static Employee get() {
        return tl.get();
    }

    // ä»å½“å‰çº¿ç¨‹ä¸Šè§£ç»‘EMPçš„å¯¹è±¡
    public static void remove() {
        tl.remove();
    }
}
```

Servletçš„è¿è¡Œæ˜¯å¤šçº¿ç¨‹çš„ï¼Œä½†æ˜¯åº”ç”¨æœåŠ¡å™¨ï¼ˆè¿™é‡ŒæŒ‡çš„æ˜¯Tomcatï¼‰åªä¼šåˆ›å»ºä¸€ä¸ªServletå®ä¾‹ï¼Œè¿™ä¸ªå®ä¾‹è¢«å¤šä¸ªçº¿ç¨‹å¹¶å‘è°ƒç”¨ã€‚æ¯æ¬¡è°ƒç”¨doGet()æ–¹æ³•ï¼Œsessionå¯èƒ½è¢«é‡ç½®ï¼Œå¯¼è‡´å­˜å‚¨æ··ä¹±ã€‚ThreadLocalå°±æ˜¯ç”¨äºè§£å†³æ­¤é—®é¢˜ã€‚



### MybtisPlusè‡ªåŠ¨å¡«å……

MybtisPlusæä¾›è‡ªåŠ¨å¡«å……çš„åŠŸèƒ½

1. åœ¨éœ€è¦å¡«å……çš„å­—æ®µä¸Šæ–¹æ·»åŠ æ³¨è§£`@TableField(fill = FieldFill.INSERT)`

   éœ€è¦åœ¨ä»€ä¹ˆæ—¶å€™è‡ªåŠ¨å¡«å……ï¼ŒFieldFillå°±é€‰æ‹©ä»€ä¹ˆ

```java
/**
 * åˆ›å»ºæ—¶é—´
 */
@TableField(fill = FieldFill.INSERT)
private LocalDateTime createTime;

...
æ›´æ–°æ—¶é—´ã€åˆ›å»ºäººã€ä¿®æ”¹äºº    
...
```

2. å®ç°MetaObjectHandleræ¥å£ï¼Œé‡å†™å¯¹åº”çš„æ–¹æ³•

```java
package com.itheima.config;

import cn.hutool.core.util.ObjectUtil;
import com.baomidou.mybatisplus.core.handlers.MetaObjectHandler;
import com.itheima.utils.EmpThreadLocal;
import com.itheima.utils.UserThreadLocal;
import org.apache.ibatis.reflection.MetaObject;
import org.springframework.stereotype.Component;

import java.time.LocalDateTime;

/**
 * @author zyf
 * @program: reggie_take_out
 * @description:
 * @date 2022-09-12 15:14:37
 */
@Component
public class MybatisPlusMetaObjectHandler implements MetaObjectHandler {

    // å½“æˆ‘ä»¬è°ƒç”¨MPçš„æ–°å¢æ–¹æ³•æ—¶ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œ
    @Override
    public void insertFill(MetaObject metaObject) {
        // metaObject æˆ‘ä»¬è°ƒç”¨æ–°å¢æ–¹æ³•æ—¶ä¼ é€’çš„å¯¹è±¡
        if (metaObject.hasGetter("createTime") && ObjectUtil.isNull(getFieldValByName("createTime", metaObject)))
            setFieldValByName("createTime", LocalDateTime.now(), metaObject);
        if (metaObject.hasGetter("updateTime") && ObjectUtil.isNull(getFieldValByName("updateTime", metaObject)))
            setFieldValByName("updateTime", LocalDateTime.now(), metaObject);
        if (metaObject.hasGetter("createUser") && ObjectUtil.isNull(getFieldValByName("createUser", metaObject)))
            setFieldValByName("createUser", ObjectUtil.isNotNull(EmpThreadLocal.get()) ? EmpThreadLocal.get().getId() : UserThreadLocal.get().getId(), metaObject);
        if (metaObject.hasGetter("updateUser") && ObjectUtil.isNull(getFieldValByName("updateUser", metaObject)))
            setFieldValByName("updateUser", ObjectUtil.isNotNull(EmpThreadLocal.get()) ? EmpThreadLocal.get().getId() : UserThreadLocal.get().getId(), metaObject);
    }

    @Override
    public void updateFill(MetaObject metaObject) {
        if (metaObject.hasGetter("updateTime") && ObjectUtil.isNull(getFieldValByName("updateTime", metaObject)))
            setFieldValByName("updateTime", LocalDateTime.now(), metaObject);
        if (metaObject.hasGetter("updateUser") && ObjectUtil.isNull(getFieldValByName("updateUser", metaObject)))
            setFieldValByName("updateUser", ObjectUtil.isNotNull(EmpThreadLocal.get()) ? EmpThreadLocal.get().getId() : UserThreadLocal.get().getId(), metaObject);
    }
}
```



### MybatisPlusåˆ†é¡µæŸ¥è¯¢

> MybatisPlusæä¾›çš„æ’ä»¶éƒ½å°†åŸºäºæ¥å£InnerInterceptoræ¥å®ç°åŠŸèƒ½ï¼Œç›®å‰å·²æœ‰çš„åŠŸèƒ½åŒ…æ‹¬åˆ†é¡µæŸ¥è¯¢ã€‚

1. æ–°å»ºé…ç½®ç±»ï¼ŒåŠ å…¥æ‰«æã€‚æˆ–ç›´æ¥åœ¨SpringBootçš„å¯åŠ¨ç±»ä¸­é…ç½®å¦‚ä¸‹ä»£ç ï¼š

```java
@Bean
public MybatisPlusInterceptor mybatisPlusInterceptor() {
    MybatisPlusInterceptor mybatisPlusInterceptor = new MybatisPlusInterceptor();
    mybatisPlusInterceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.MYSQL));
    return mybatisPlusInterceptor;
}
```

2. ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹

```java
@Override
public R findEmployeeByPage(EmpPageDto empPageDto) {
    empPageDto.check();

    // åˆ†é¡µå¯¹è±¡
    Page<Employee> pageInfo = new Page<>(empPageDto.getPage(), empPageDto.getPageSize());

    this.page(pageInfo,
            Wrappers.lambdaQuery(Employee.class)
              		// æ·»åŠ åˆ†é¡µç­›é€‰ç›¸å…³æ¡ä»¶
                    .like(StrUtil.isNotEmpty(empPageDto.getName()), Employee::getName, empPageDto.getName())
              		// æ·»åŠ åˆ†é¡µæ’åºæ¡ä»¶
                    .orderByDesc(Employee::getUpdateTime));

    // å¯ä»¥ç›´æ¥å–å‡ºåˆ†é¡µæŸ¥è¯¢å¾—åˆ°çš„ç»“æœé›†ï¼Œç„¶åå¯¹ç»“æœé›†è¿›è¡Œæ“ä½œï¼Œä¿®æ”¹ç»“æœé›†ä¸­å•ä¸ªå…ƒç´ çš„å±æ€§
    
    return R.success(pageInfo);
}
```



### Longç±»å‹ç²¾åº¦ä¸¢å¤±

1. åœ¨å‘˜å·¥ä¿¡æ¯ä¿®æ”¹æ—¶ï¼Œéœ€è¦é€šè¿‡æŸ¥æ‰¾ï¼Œå®ç°ä¿¡æ¯å›æ˜¾

2. ä¿®æ”¹è¿‡åï¼Œå‘ç°å›æ˜¾åŠŸèƒ½ä¸èƒ½å®ç°ï¼ŒæŸ¥çœ‹æ•°æ®åº“ï¼ŒåŸæœ‰çš„idè¢«æ”¹å˜ï¼Œæœ€åå››ä½å˜æˆäº†0ã€‚

   æœåŠ¡ç«¯ä¼šå°†è¿”å›çš„Rå¯¹è±¡è¿›è¡Œjsonåºåˆ—åŒ–ï¼Œè½¬æ¢ä¸ºjsonæ ¼å¼çš„æ•°æ®ï¼Œè€Œå‘˜å·¥çš„IDæ˜¯ä¸€ä¸ªLongç±»å‹çš„æ•°æ®ï¼Œè€Œä¸”æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º 19 ä½çš„é•¿æ•´å‹æ•°æ®ï¼Œ è¯¥æ•°æ®è¿”å›ç»™å‰ç«¯æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚

   ä½†æ˜¯åœ¨å‰ç«¯JSä¸­ï¼Œ jsåœ¨å¯¹é•¿åº¦è¾ƒé•¿çš„é•¿æ•´å‹æ•°æ®è¿›è¡Œå¤„ç†æ—¶ï¼Œ ä¼šæŸå¤±ç²¾åº¦ï¼Œ ä»è€Œå¯¼è‡´æäº¤çš„idå’Œæ•°æ®åº“ä¸­çš„idä¸ä¸€è‡´ã€‚

3. ä¿®æ”¹å®ä½“ç±»ï¼Œåœ¨Longç±»å‹çš„å±æ€§ä¸Šæ·»åŠ ä¸€è¡Œæ³¨é‡Šï¼Œè®©ç³»ç»Ÿåºåˆ—åŒ–æ—¶ï¼Œä¿ç•™ç›¸å…³ç²¾åº¦ã€‚

```java
@JsonSerialize(using = ToStringSerializer.class)
```



### å¯¹è±¡æ˜ å°„å™¨

ä¸Šè¿°ä¿®æ”¹éœ€è¦åœ¨æ¯å¤„ç”¨åˆ°çš„åœ°æ–¹æ·»åŠ æ³¨é‡Šï¼Œåœ¨èµ„æ–™ä¸­çœ‹è§å¦ä¸€ç§æ–¹æ³•

1. æä¾›å¯¹è±¡è½¬æ¢å™¨JacksonObjectMapperï¼ŒåŸºäºJacksonè¿›è¡ŒJavaå¯¹è±¡åˆ°jsonæ•°æ®çš„è½¬æ¢

```java
package com.itheima.mapper;

import com.fasterxml.jackson.databind.DeserializationFeature;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.module.SimpleModule;
import com.fasterxml.jackson.databind.ser.std.ToStringSerializer;
import com.fasterxml.jackson.datatype.jsr310.deser.LocalDateDeserializer;
import com.fasterxml.jackson.datatype.jsr310.deser.LocalDateTimeDeserializer;
import com.fasterxml.jackson.datatype.jsr310.deser.LocalTimeDeserializer;
import com.fasterxml.jackson.datatype.jsr310.ser.LocalDateSerializer;
import com.fasterxml.jackson.datatype.jsr310.ser.LocalDateTimeSerializer;
import com.fasterxml.jackson.datatype.jsr310.ser.LocalTimeSerializer;
import java.math.BigInteger;
import java.time.LocalDate;
import java.time.LocalDateTime;
import java.time.LocalTime;
import java.time.format.DateTimeFormatter;
import static com.fasterxml.jackson.databind.DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES;

/**
 * å¯¹è±¡æ˜ å°„å™¨:åŸºäºjacksonå°†Javaå¯¹è±¡è½¬ä¸ºjsonï¼Œæˆ–è€…å°†jsonè½¬ä¸ºJavaå¯¹è±¡
 * å°†JSONè§£æä¸ºJavaå¯¹è±¡çš„è¿‡ç¨‹ç§°ä¸º [ä»JSONååºåˆ—åŒ–Javaå¯¹è±¡]
 * ä»Javaå¯¹è±¡ç”ŸæˆJSONçš„è¿‡ç¨‹ç§°ä¸º [åºåˆ—åŒ–Javaå¯¹è±¡åˆ°JSON]
 */
public class JacksonObjectMapper extends ObjectMapper {

    public static final String DEFAULT_DATE_FORMAT = "yyyy-MM-dd";
    public static final String DEFAULT_DATE_TIME_FORMAT = "yyyy-MM-dd HH:mm:ss";
    public static final String DEFAULT_TIME_FORMAT = "HH:mm:ss";

    public JacksonObjectMapper() {
        super();
        //æ”¶åˆ°æœªçŸ¥å±æ€§æ—¶ä¸æŠ¥å¼‚å¸¸
        this.configure(FAIL_ON_UNKNOWN_PROPERTIES, false);

        //ååºåˆ—åŒ–æ—¶ï¼Œå±æ€§ä¸å­˜åœ¨çš„å…¼å®¹å¤„ç†
        this.getDeserializationConfig().withoutFeatures(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);
        
        SimpleModule simpleModule = new SimpleModule()
                .addDeserializer(LocalDateTime.class, new LocalDateTimeDeserializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_TIME_FORMAT)))
                .addDeserializer(LocalDate.class, new LocalDateDeserializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_FORMAT)))
                .addDeserializer(LocalTime.class, new LocalTimeDeserializer(DateTimeFormatter.ofPattern(DEFAULT_TIME_FORMAT)))

                .addSerializer(BigInteger.class, ToStringSerializer.instance)
                .addSerializer(Long.class, ToStringSerializer.instance)
                .addSerializer(LocalDateTime.class, new LocalDateTimeSerializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_TIME_FORMAT)))
                .addSerializer(LocalDate.class, new LocalDateSerializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_FORMAT)))
                .addSerializer(LocalTime.class, new LocalTimeSerializer(DateTimeFormatter.ofPattern(DEFAULT_TIME_FORMAT)));

        //æ³¨å†ŒåŠŸèƒ½æ¨¡å— ä¾‹å¦‚ï¼Œå¯ä»¥æ·»åŠ è‡ªå®šä¹‰åºåˆ—åŒ–å™¨å’Œååºåˆ—åŒ–å™¨
        this.registerModule(simpleModule);
    }
}
```

2. åœ¨WebMvcConfigé…ç½®ç±»ä¸­æ‰©å±•Spring mvcçš„æ¶ˆæ¯è½¬æ¢å™¨ï¼Œåœ¨æ­¤æ¶ˆæ¯è½¬æ¢å™¨ä¸­ä½¿ç”¨æä¾›çš„å¯¹è±¡è½¬æ¢å™¨è¿›è¡ŒJavaå¯¹è±¡åˆ°jsonæ•°æ®çš„è½¬æ¢

```java
@Override
public void extendMessageConverters(List<HttpMessageConverter<?>> converters) {
    log.info("æ¶ˆæ¯è½¬æ¢å™¨...");
    // åˆ›å»ºæ¶ˆæ¯è½¬æ¢å™¨å¯¹è±¡
    MappingJackson2HttpMessageConverter converter = new MappingJackson2HttpMessageConverter();
    // è®¾ç½®å¯¹è±¡è½¬æ¢å™¨ï¼Œåº•å±‚ä½¿ç”¨Jacksonå°†Javaå¯¹è±¡è½¬ä¸ºjson
    converter.setObjectMapper(new JacksonObjectMapper());
    // å°†ä¸Šé¢çš„æ¶ˆæ¯è½¬æ¢å™¨å¯¹è±¡è¿½åŠ åˆ°mvcæ¡†æ¶çš„è½¬æ¢å™¨é›†åˆä¸­
    converters.add(0, converter);
}
```



### MybatisPlusä¸€å¯¹å¤šå…³ç³»æŸ¥è¯¢å®ç°

å½“å‰ç«¯æŸ¥è¯¢æ—¶ï¼Œæœ‰æ—¶ä¼šéœ€è¦æä¾›å¤šè¡¨æ•°æ®ï¼Œå³è¿”å›çš„æ•°æ®æ— æ³•å¯¹åº”åŸæœ‰çš„å®ä½“ç±»çš„æƒ…å†µï¼Œå¸¸ç”¨çš„æ–¹æ³•æ˜¯ä¸ºå‰ç«¯è¯·æ±‚çš„æ•°æ®å°è£…ä¸€ä¸ªdtoå¯¹è±¡ï¼Œåœ¨æ­¤é¡¹ç›®ä¸­ï¼Œé‡‡ç”¨çš„æ–¹æ³•æ˜¯åœ¨å®ä½“ç±»ä¸­åŠ å…¥ä¸€ä¸ªå±æ€§ã€‚

ä¾‹å¦‚ï¼šåœ¨Dishå®ä½“ç±»ä¸­åŠ å…¥

```java
// æ•°æ®åº“æŸ¥è¯¢æ—¶ï¼Œé¿å…æŸ¥è¯¢è¿™ä¸ªå­—æ®µï¼Œé€ æˆsqlè¯­å¥é”™è¯¯
@TableField(exist = false)
private List<DishFlavor> flavors;
```

åç»­æŸ¥è¯¢æ—¶å¯ä»¥å¯¹è¿™ä¸ªlistç›´æ¥set/getï¼Œå®ç°ä¸šåŠ¡éœ€æ±‚ã€‚

â—â—â—éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºæ˜¯å°†æ­¤å®ä½“ç±»å½“æˆdtoä½¿ç”¨ï¼Œå®šä¹‰çš„æ•°æ®éœ€è¦ä¸å‰ç«¯è¯·æ±‚çš„æ•°æ®ç›¸åŒï¼Œå³flavorsä¸èƒ½æ”¹ä¸ºflavorListã€‚



### äº‹åŠ¡çš„å¼€å¯

æ¶‰åŠåˆ°å¤šè¡¨æ•°æ®ï¼Œå°±ä¼šæ¶‰åŠåˆ°å¤šè¡¨åŒæ—¶å¢åˆ æ”¹ï¼Œéœ€è¦äº‹åŠ¡çš„åŠ å…¥ï¼ŒSpringBootçš„äº‹åŠ¡å¼€å¯éœ€è¦åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£`@EnableTransactionManagement`ï¼Œå¯¹äºéœ€è¦åŠ å…¥äº‹åŠ¡çš„æ–¹æ³•åˆ™ä½¿ç”¨æ³¨è§£`@Transactional`



### MybatisPlusé€»è¾‘åˆ é™¤

MybatisPlusé€»è¾‘åˆ é™¤çš„å®ç°åªéœ€è¦åœ¨å®ä½“ç±»ä¸­åŠ å…¥å¦‚ä¸‹ï¼š

```java
// valueï¼šé»˜è®¤é€»è¾‘æœªåˆ é™¤å€¼ delvalï¼šé»˜è®¤é€»è¾‘åˆ é™¤å€¼
@TableLogic(value = "0", delval = "1")
private Integer isDeleted;
```

â—â—â—é€»è¾‘åˆ é™¤åï¼Œæ­¤æ¡æ•°æ®åœ¨ä½¿ç”¨æŸ¥è¯¢æ—¶ï¼Œå°†è¢«è‡ªåŠ¨æ‹¼æ¥åˆ é™¤æ¡ä»¶ï¼Œä¼šé€ æˆåŸæœ‰ä»£ç åœ¨æ•°æ®åˆ¤é‡æ—¶çš„é”™è¯¯ï¼Œå¦‚æœä¾æ—§éœ€è¦æ­¤ä¸šåŠ¡ï¼Œè¦é‡æ–°å†™sqlè¯­å¥ã€‚åœ¨æ­¤é¡¹ç›®ä¸­ï¼Œæ²¡æœ‰ä½¿ç”¨é€»è¾‘åˆ é™¤ã€‚



### å…¨å±€å¼‚å¸¸å¤„ç†å™¨

å…¨å±€å¼‚å¸¸å¤„ç†å™¨ä¸€èˆ¬ä¸è‡ªå®šä¹‰å¼‚å¸¸ä¸€èµ·ä½¿ç”¨

```java
package com.itheima.ex;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

/**
 * @author zyf
 * @program: bank
 * @description: è‡ªå®šä¹‰å¼‚å¸¸
 * @date 2022-09-06 16:02:12
 */
@NoArgsConstructor
@AllArgsConstructor
@Data
public class  MyException extends RuntimeException {
    /**
     * é”™è¯¯ç 
     */
    private Integer code;
    /**
     * æè¿°å¼‚å¸¸çš„ä¿¡æ¯
     */
    private String message;
}
```

```java
package com.itheima.ex;

import com.itheima.vo.R;
import lombok.extern.slf4j.Slf4j;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.RestController;

/**
 * @author zyf
 * @program: reggie_take_out
 * @description:
 * @date 2022-09-20 10:48:04
 */
@RestController
@Slf4j
public class ReggieExHandler {
    // è‡ªå®šä¹‰å¼‚å¸¸
    @ExceptionHandler(MyException.class)
    public R myEx(MyException ex) {
        if (ex.getCode() == 2000){
            // TODO:å¦‚æœæ˜¯2000è¯´æ˜æ˜¯æ ¸å¿ƒä¸šåŠ¡ å¿…é¡»è¦é€šçŸ¥å¼€å‘æˆ–è€…è¿ç»´äººå‘˜ çŸ­ä¿¡å‘é€
            System.out.println("å‘çŸ­ä¿¡...");
        } else{
            log.error(ex.getMessage());
        }
        return R.error(ex.getMessage());
    }

    // å…¶ä»–å¼‚å¸¸
    @ExceptionHandler(Exception.class)
    public R ex(Exception ex) {
        log.error(ex.getMessage());
        return R.error(ex.getMessage());
    }
}
```



### è‡ªå®šä¹‰æ³¨è§£ä¸æ‹¦æˆª

ä¿®æ”¹ç›´æ¥åœ¨æ‹¦æˆªå™¨ä¸­æ·»åŠ æ”¾è¡Œè·¯å¾„çš„æ–¹å¼ï¼Œä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£å¹¶è§£æï¼Œåœ¨éœ€è¦æ”¾è¡Œçš„æ–¹æ³•ä¸Šï¼Œä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£@NoAuthã€‚

```java
package com.itheima.anno;

import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

/**
 * @author zyf
 * @program: reggie_take_out
 * @description:
 * @date 2022-09-20 11:16:25
 */
/**
 * è‡ªå®šä¹‰æ³¨è§£
 * æ³¨è§£: æœ¬è´¨å°±æ˜¯ä¸€ä¸ªæ ‡è®°   è‡ªèº«æœ‰åŠŸèƒ½å—  æ²¡æœ‰ä»»ä½•åŠŸèƒ½
 * æ³¨è§£å†™äº†ä¹‹åä¸€å®šè¦æœ‰äººå»è§£æè¿™ä¸ªæ³¨è§£
 *
 * æ³¨è§£çš„ç”Ÿå‘½å‘¨æœŸ
 * é»˜è®¤çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ åªå­˜åœ¨äº æºç é˜¶æ®µ (ç¼–è¯‘é˜¶æ®µ/è¿è¡Œé˜¶æ®µ)
 * æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨è¿™ä¸ªæ³¨è§£ä¸Šæ·»åŠ ä¸€äº›å…ƒæ³¨è§£æ¥è®¾ç½®è¿™ä¸ªæ³¨è§£çš„ç”Ÿå‘½å‘¨æœŸ
 */
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface NoAuth {
    /* æ³¨è§£ä¸­å¯ä»¥å®šä¹‰å±æ€§ */
    /* å±æ€§åç§°åè¦åŠ å°æ‹¬å· è¯­æ³•ç±»ä¼¼äº†æ¥å£ä¸­å®šä¹‰æ–¹æ³• */
    /* å±æ€§åå¯ä»¥è·Ÿä¸Šdefault æ¥ç»™è¿™ä¸ªå±æ€§èµ‹é»˜è®¤å€¼ */
    /* å¦‚æœè¿™ä¸ªå±æ€§æœ‰é»˜è®¤å€¼ åœ¨ä½¿ç”¨è¿™ä¸ªæ³¨è§£çš„æ—¶å€™ è¿™ä¸ªå±æ€§å¯ä»¥ä¸ç”¨èµ‹å€¼ */
    /* å¦‚æœè¿™ä¸ªå±æ€§æ²¡æœ‰é»˜è®¤å€¼ åœ¨ä½¿ç”¨è¿™ä¸ªæ³¨è§£çš„æ—¶å€™å°±å¿…é¡»è¦ç»™è¿™ä¸ªå±æ€§èµ‹å€¼ å¦åˆ™æŠ¥é”™ */
    /* å¦‚æœå±æ€§çš„åç§°æ˜¯value å¹¶ä¸”åªæœ‰è¿™ä¸€ä¸ªå±æ€§ åœ¨èµ‹å€¼çš„æ—¶å€™ å±æ€§åvalueå¯ä»¥çœç•¥ä¸å†™ */
    /* å¦‚æœå±æ€§çš„åç§°æ˜¯value ä½†æ˜¯æœ‰å¤šä¸ªå±æ€§ å¹¶ä¸”å…¶ä»–å±æ€§éƒ½æœ‰é»˜è®¤å€¼ å•ç‹¬ç»™è¿™ä¸ªvalueå±æ€§èµ‹å€¼çš„æ—¶å€™ å±æ€§åä¹Ÿå¯ä»¥çœç•¥ä¸å†™ */
    /* æ³¨è§£ä¸­æ”¯å‡ºçš„å±æ€§ç±»å‹æœ‰: */
    /*  åŸºæœ¬æ•°æ®ç±»å‹;
       String;
       æšä¸¾;
       æ³¨è§£;
    */

    /*int value();

    String uername() default "";*/
}
```

åœ¨æ‹¦æˆªå™¨ä¸­æ”¾è¡Œä¿®æ”¹å¦‚ä¸‹ï¼š

```java
/*if (request.getRequestURI().contains("employee/login")) return true;
        if (request.getRequestURI().contains("user/login")) return true;
        if (request.getRequestURI().contains("user/sendMsg")) return true;*/

if (((HandlerMethod) handler).hasMethodAnnotation(NoAuth.class)) return true;
```

------

## ä»£ç ä¼˜åŒ–

### redisçš„ä½¿ç”¨

1. å­˜åœ¨çš„é—®é¢˜

   ç”±äºæœ¬é¡¹ç›®ä¸­ç§»åŠ¨ç«¯æ˜¯é¢å‘æ‰€æœ‰çš„æ¶ˆè´¹è€…çš„ï¼Œè¯·æ±‚å‹åŠ›ç›¸å¯¹æ¯”è¾ƒå¤§ï¼Œè€Œæˆ‘ä»¬å½“å‰æ‰€æœ‰çš„æ•°æ®æŸ¥è¯¢éƒ½æ˜¯ä»æ•°æ®åº“MySQLä¸­ç›´æ¥æŸ¥è¯¢çš„ï¼Œé‚£ä¹ˆå¯èƒ½å°±å­˜åœ¨å¦‚ä¸‹é—®é¢˜ï¼š ==é¢‘ç¹è®¿é—®æ•°æ®åº“ï¼Œæ•°æ®åº“è®¿é—®å‹åŠ›å¤§ï¼Œç³»ç»Ÿæ€§èƒ½ä¸‹é™ï¼Œç”¨æˆ·ä½“éªŒè¾ƒå·®ã€‚==

2. è§£å†³æ–¹æ³•

   ä½¿ç”¨Redisï¼Œé€šè¿‡Redisæ¥åšç¼“å­˜ï¼Œä»è€Œé™ä½æ•°æ®åº“çš„è®¿é—®å‹åŠ›ï¼Œæé«˜ç³»ç»Ÿçš„è®¿é—®æ€§èƒ½ï¼Œä»è€Œæå‡ç”¨æˆ·ä½“éªŒã€‚åŠ å…¥Redisåšç¼“å­˜ä¹‹åï¼Œæˆ‘ä»¬åœ¨è¿›è¡Œæ•°æ®æŸ¥è¯¢æ—¶ï¼Œå°±éœ€è¦å…ˆæŸ¥è¯¢ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜ä¸­æœ‰æ•°æ®ï¼Œç›´æ¥è¿”å›ï¼Œå¦‚æœç¼“å­˜ä¸­æ²¡æœ‰æ•°æ®ï¼Œåˆ™éœ€è¦æŸ¥è¯¢æ•°æ®åº“ï¼Œå†å°†æ•°æ®åº“æŸ¥è¯¢çš„ç»“æœï¼Œç¼“å­˜åœ¨redisä¸­ã€‚

#### çŸ­ä¿¡å‘é€ç¼“å­˜éªŒè¯ç 

```java
@Override
public R sendMsg(String phone) {
    if (!PhoneUtil.isMobile(phone)) return R.error("æ‰‹æœºå·ç ä¸åˆæ³•");
    /*SMSUtils.sendSM(phone,code);*/
    // ç”Ÿæˆ6ä½éªŒè¯ç 
    String code = RandomUtil.randomNumbers(6);
    System.out.println("code = " + code);
    // æ•°æ®åº“å­˜å‚¨
    redisTemplate.opsForValue().set(phone + "_CODE", code);
    return R.success(code);
}
@Override
public R login(Map<String, String> phoneMap) {
    String phone = phoneMap.get("phone");
    String code = phoneMap.get("code");
    // ä»æ•°æ®åº“ä¸­å–å‡ºéªŒè¯ç 
    String redisCode = (String) redisTemplate.opsForValue().get(phone + "_CODE");
    ...
}
```

#### åœ°å€è¡¨çš„redisä¼˜åŒ–

```java
	@Override
    public R listAddressBook() {
        // Redisä¸­å·²ç»ç¼“å­˜äº†ä¸ªäººçš„åœ°å€ ç›´æ¥è¿”å›å³å¯
        String addressBook = redisTemplate.opsForValue().get("reggie_addressBook_uid_" + UserThreadLocal.get().getId());
        // æŠŠJSONå­—ç¬¦ä¸²æ•°æ®ååºåˆ—åŒ–æˆListé›†åˆ
        List<AddressBook> addressBooks = JSONUtil.toList(addressBook, AddressBook.class);
        if (CollUtil.isNotEmpty(addressBooks)) return R.success(addressBooks);

        List<AddressBook> list = this.list(Wrappers.lambdaQuery(AddressBook.class)
                .eq(ObjectUtil.isNotNull(UserThreadLocal.get().getId()), AddressBook::getUserId, UserThreadLocal.get().getId()));
        // redisæ•°æ®åº“å­˜å…¥æ•°æ®ï¼Œä¸€èˆ¬æƒ…å†µä¸‹éƒ½ä¼šè®¾ç½®ç”Ÿå­˜æ—¶é—´
        redisTemplate.opsForValue()
                .set("reggie_addressBook_uid_" + UserThreadLocal.get().getId(), JSONUtil.toJsonStr(list),
                        30, TimeUnit.DAYS);
        return R.success(list);
    }
```

â—â—â—==Redisä¸­å­˜å‚¨çš„æ•°æ®é€šå¸¸ä¼šæœ‰ä¸¤ç§==ï¼š

1. ä¸šåŠ¡ä¸­çš„ä¸´æ—¶æ€§æ•°æ®ï¼ˆé¡¹ç›®åç§°:æ¨¡å—åç§°:ä¸šåŠ¡åç§°:å”¯ä¸€æ ‡è¯† å€¼ï¼‰

   æ‰‹æœºéªŒè¯ç ï¼š regiee:user:userlogin:1341111111 234533

2. æ•°æ®åº“ä¸­çš„ç¼“å­˜æ•°æ®ï¼ˆæ•°æ®åº“åç§°:è¡¨åç§°:ä¸»é”®åç§°:ä¸»é”®å€¼ å€¼ï¼‰

   ç”¨æˆ·æ”¶è´§åœ°å€ï¼šregiee:addressbook:uid:15 [{},{},{}] 



#### ç±»åˆ«è¡¨çš„redisä¼˜åŒ–

ç”±äºæ˜¯ç§»åŠ¨ç«¯é¢å¯¹è¯·æ±‚å‹åŠ›è¾ƒå¤§ï¼Œæœ¬æ¬¡ä¼˜åŒ–å‡æ˜¯é’ˆå¯¹ç§»åŠ¨ç«¯ã€‚æˆ‘ä»¬è®¿é—®é¡µé¢çš„æ—¶å€™ï¼Œé€šè¿‡æŠ“åŒ…å¯ä»¥çœ‹åˆ°å¯¹äºç±»åˆ«è¡¨çš„è¯·æ±‚ï¼Œå°†æ­¤æ–¹æ³•ä¿®æ”¹åˆ°Serviceå±‚ä¸­ç¼–å†™é€»è¾‘ï¼Œä¼ å…¥å‚æ•°ä»ä¸ºåŸæ¥çš„typeï¼ˆæ­¤å‚æ•°åœ¨webç«¯æŸ¥è¯¢æ•°æ®æ—¶ç”¨åˆ°ï¼‰

1. redisä¸­å­˜å‚¨çš„keyä¸ºreggie_category_categorylist
2. å°†è¡¨ä¸­æ‰€æœ‰æ•°æ®å­˜å…¥redisï¼Œé€šè¿‡keyæŸ¥è¯¢åˆ°ç¼“å­˜åï¼Œå†æ ¹æ®typeæ·»åŠ ç­›é€‰æ¡ä»¶ã€‚
3. å¦‚æœç¼“å­˜ä¸­æ²¡æœ‰æ•°æ®ï¼Œå°†æŸ¥å‡ºçš„æ•°æ®å­˜å…¥ç¼“å­˜
4. åœ¨å¢ã€åˆ ã€æ”¹ç±»åˆ«è¡¨çš„å‰åï¼Œå¯¹redisè¿›è¡Œæ¸…é™¤æ“ä½œ

```java
@Override
public R findCategory(Integer type) {
    String jsonList = redisTemplate.opsForValue().get("reggie_category_categorylist");
    List<Category> categories = JSONUtil.toList(jsonList, Category.class);
    if (CollUtil.isNotEmpty(categories)) {
        return R.success(ObjectUtil.isNotNull(type) ? categories.stream()
                // å¦‚æœtypeä¸ä¸ºç©º æ·»åŠ ç­›é€‰æ¡ä»¶ type
                .filter(category -> category.getType().equals(type))
                .collect(Collectors.toList()) : categories);
    }

    List<Category> list = this.list(Wrappers.lambdaQuery(Category.class)
            .orderByAsc(Category::getType)
            .orderByAsc(Category::getSort));
    
    if (CollUtil.isNotEmpty(list))
        redisTemplate.opsForValue().set("reggie_category_categorylist",
                JSONUtil.toJsonStr(list),
                30, TimeUnit.DAYS);

    return R.success(list);
}
```

#### èœå“è¡¨çš„redisä¼˜åŒ–

é€»è¾‘ä¸ä¸Šè¿°ç›¸ä¼¼ï¼Œä¸åŒç‚¹åœ¨äºredisçš„keyä¸­åŠ å…¥äº†åˆ†ç±»idä½œä¸ºä¸€æ¬¡æŸ¥è¯¢çš„å”¯ä¸€æ ‡è¯†ï¼Œä½†ç”±äºåŸæœ‰æŸ¥è¯¢æ¶‰åŠåˆ°çš„statusï¼ˆä¸»è¦ç”¨äºç§»åŠ¨ç«¯æŸ¥è¯¢ï¼‰çš„å€¼ï¼Œä¾æ—§éœ€è¦åœ¨æŸ¥å‡ºå€¼åè¿›è¡Œè¿‡æ»¤ã€‚



#### å¥—é¤è¡¨çš„redisä¼˜åŒ–

ä¸ä¸Šè¿°ç›¸ä¼¼ã€‚



#### redisåŒåˆ æœºåˆ¶

> å»¶è¿ŸåŒåˆ ç­–ç•¥æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ•°æ®åº“å­˜å‚¨å’Œç¼“å­˜æ•°æ®ä¿æŒä¸€è‡´æ€§çš„å¸¸ç”¨ç­–ç•¥ï¼Œä½†å®ƒä¸æ˜¯å¼ºä¸€è‡´ã€‚å…¶å®ä¸ç®¡å“ªç§æ–¹æ¡ˆï¼Œéƒ½é¿å…ä¸äº†Rediså­˜åœ¨è„æ•°æ®çš„é—®é¢˜ï¼Œåªèƒ½å‡è½»è¿™ä¸ªé—®é¢˜ï¼Œè¦æƒ³å½»åº•è§£å†³ï¼Œå¾—è¦ç”¨åˆ°åŒæ­¥é”å’Œå¯¹åº”çš„ä¸šåŠ¡é€»è¾‘å±‚é¢è§£å†³ã€‚

**ä¸ºä»€ä¹ˆæ‰§è¡Œï¼Ÿ**

ä¸€èˆ¬æˆ‘ä»¬åœ¨æ›´æ–°æ•°æ®åº“æ•°æ®æ—¶ï¼Œéœ€è¦åŒæ­¥redisä¸­ç¼“å­˜çš„æ•°æ®ï¼Œæ‰€ä»¥å­˜åœ¨ä¸¤ç§æ–¹æ³•ï¼š

ç¬¬ä¸€ç§æ–¹æ¡ˆï¼šå…ˆæ‰§è¡Œupdateæ“ä½œï¼Œå†æ‰§è¡Œç¼“å­˜æ¸…é™¤ã€‚

ç¬¬äºŒç§æ–¹æ¡ˆï¼šå…ˆæ‰§è¡Œç¼“å­˜æ¸…é™¤ï¼Œå†æ‰§è¡Œupdateæ“ä½œã€‚

è¿™ä¸¤ç§æ–¹æ¡ˆçš„å¼Šç«¯æ˜¯å½“å­˜åœ¨å¹¶å‘è¯·æ±‚æ—¶ï¼Œå¾ˆå®¹æ˜“å‡ºç°ä»¥ä¸‹é—®é¢˜ï¼š

ç¬¬ä¸€ç§æ–¹æ¡ˆï¼šå½“è¯·æ±‚1æ‰§è¡Œupdateæ“ä½œåï¼Œè¿˜æœªæ¥å¾—åŠè¿›è¡Œç¼“å­˜æ¸…é™¤ï¼Œæ­¤æ—¶è¯·æ±‚2æŸ¥è¯¢åˆ°å¹¶ä½¿ç”¨äº†redisä¸­çš„æ—§æ•°æ®ã€‚

ç¬¬äºŒç§æ–¹æ¡ˆï¼šå½“è¯·æ±‚1æ‰§è¡Œæ¸…é™¤ç¼“å­˜åï¼Œè¿˜æœªè¿›è¡Œupdateæ“ä½œï¼Œæ­¤æ—¶è¯·æ±‚2è¿›è¡ŒæŸ¥è¯¢åˆ°äº†æ—§æ•°æ®å¹¶å†™å…¥äº†redisã€‚

**å¦‚ä½•å®ç°ï¼Ÿ**

â—å…ˆè¿›è¡Œç¼“å­˜æ¸…é™¤ï¼Œå†æ‰§è¡Œupdateï¼Œæœ€åï¼ˆå»¶è¿ŸNç§’ï¼‰å†æ‰§è¡Œç¼“å­˜æ¸…é™¤ã€‚

ä¸Šè¿°ä¸­ï¼ˆå»¶è¿ŸNç§’ï¼‰çš„æ—¶é—´è¦å¤§äºä¸€æ¬¡å†™æ“ä½œçš„æ—¶é—´ï¼Œä¸€èˆ¬ä¸º3-5ç§’ã€‚

åŸå› ï¼šå¦‚æœå»¶è¿Ÿæ—¶é—´å°äºå†™å…¥redisçš„æ—¶é—´ï¼Œä¼šå¯¼è‡´è¯·æ±‚1æ¸…é™¤äº†ç¼“å­˜ï¼Œä½†æ˜¯è¯·æ±‚2ç¼“å­˜è¿˜æœªå†™å…¥çš„å°´å°¬ã€‚ã€‚ã€‚

psï¼šä¸€èˆ¬å†™å…¥çš„æ—¶é—´ä¼šè¿œå°äº5ç§’



### SpringCacheï¼ˆäº†è§£ï¼‰

> ç¼“å­˜é™¤äº†ä¿å­˜åœ¨Redisï¼Œè¿˜å¯ä»¥ä¿å­˜åœ¨WEBæœåŠ¡å™¨ä¸­ï¼ˆServletContextï¼‰
>
> SpringCacheæ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œæä¾›æ³¨è§£ï¼Œä½¿ç”¨è¿™äº›æ³¨è§£å¯ä»¥æŠŠæ•°æ®ä¿å­˜åˆ°WEBæœåŠ¡å™¨ï¼ˆé»˜è®¤ä¿å­˜ç¼“å­˜çš„ä½ç½®ï¼‰
>
> å¦‚æœæ˜¯ç¼“å­˜åˆ°WEBæœåŠ¡å™¨ä¸­ï¼Œé‚£ä¹ˆ==æœåŠ¡é‡å¯æ•°æ®å°±ä¼šä¸¢å¤±==

1. åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ `@EnableCaching`
2. åœ¨ä¿å­˜æ–¹æ³•ä¸ŠåŠ æ³¨è§£`@CachePut`

```java
/**
* CachePutï¼šå°†æ–¹æ³•è¿”å›å€¼æ”¾å…¥ç¼“å­˜
* valueï¼šç¼“å­˜çš„åç§°ï¼Œæ¯ä¸ªç¼“å­˜åç§°ä¸‹é¢å¯ä»¥æœ‰å¤šä¸ªkey
* keyï¼šç¼“å­˜çš„key
*
* Redisä¸­çš„Hashç»“æ„
* Redisçš„Key : {key:value,key,values}
* userCache: {key,æ–¹æ³•çš„è¿”å›å€¼}
*
* SPEL: SpringELè¡¨è¾¾å¼ #å®¹å™¨ä¸­å–å€¼
*
* Keyçš„å†™æ³•æœ‰:
* 1. #å½¢å‚åç§° #å½¢å‚åç§°.å±æ€§åç§°
* 2. #p0 #p1 ..
* 3. #result #result.å±æ€§åç§°
*/
@CachePut(value = "userCache", key = "#user.id")
@PostMapping
public User save(User user) {
	userService.save(user);
	return user;
}
```

3. åœ¨æŸ¥è¯¢æ–¹æ³•ä¸ŠåŠ æ³¨è§£` @Cacheable`

```java
/**
* Cacheable: åœ¨æ–¹æ³•æ‰§è¡Œå‰springå…ˆæŸ¥çœ‹ç¼“å­˜ä¸­æ˜¯å¦æœ‰æ•°æ®
* å¦‚æœæœ‰æ•°æ®ï¼Œåˆ™ç›´æ¥è¿”å›ç¼“å­˜æ•°æ®ï¼›
* è‹¥æ²¡æœ‰æ•°æ®ï¼Œè°ƒç”¨æ–¹æ³•å¹¶å°†æ–¹æ³•è¿”å›å€¼æ”¾åˆ°ç¼“å­˜ä¸­
*
* valueï¼šç¼“å­˜çš„åç§°ï¼Œæ¯ä¸ªç¼“å­˜åç§°ä¸‹é¢å¯ä»¥æœ‰å¤šä¸ªkey SPEL
* keyï¼šç¼“å­˜çš„key
*/
@Cacheable(value = "userCache",key = "#id")
@GetMapping("/{id}")
public User getById(@PathVariable Long id){
	User user = userService.getById(id);
	return user;
}
```

4.  åœ¨åˆ é™¤å’Œæ›´æ–°æ–¹æ³•ä¸ŠåŠ æ³¨è§£ `@CacheEvict`

```java
/**
* CacheEvict: æ¸…ç†æŒ‡å®šç¼“å­˜
* valueï¼šç¼“å­˜çš„åç§°ï¼Œæ¯ä¸ªç¼“å­˜åç§°ä¸‹é¢å¯ä»¥æœ‰å¤šä¸ªkey
* keyï¼šç¼“å­˜çš„key
*/
@CacheEvict(value = "userCache",key = "#p0")
@DeleteMapping("/{id}")
public void delete(@PathVariable Long id){
	userService.removeById(id);
}

```



### å‰åå°åˆ†ç¦»

åœ¨å®é™…å¼€å‘ä¸­çš„å¼€å‘çš„æµç¨‹

1. åå°äººå‘˜åº”è¯¥æ ¹æ®éœ€æ±‚æ–‡æ¡£å’ŒåŸå‹å›¾å»ç¡®å®šæ¥å£

2. æ ¹æ®æ¥å£ç¼–å†™æ¥å£æ–‡æ¡£

3. æŠŠæ¥å£æ–‡æ¡£åˆ†äº«ç»™å…¶ä»–å¹³å°

4. æ‰€æœ‰å¹³å°éƒ½æŒ‰ç…§æ¥å£æ–‡æ¡£è¿›è¡Œå¼€å‘

5. å½“å…¶ä»–å¹³å°éƒ½å¼€å‘å®Œæˆåè¦è¿›è¡Œè”è°ƒ(ç”±å…¶ä»–å¹³å°å»è°ƒç”¨åå°æ¥å£)

   åå°å’Œå‰ç«¯æ˜¯åˆ†ç¦»çš„æ˜¯åŒæ­¥å¼€å‘çš„, å¹¶ä¸”æ‰€æœ‰å¹³å°éƒ½å¿…é¡»è¦ä¸¥æ ¼æŒ‰ç…§æ¥å£æ–‡æ¡£è¿›è¡Œå¼€å‘ã€‚åå°çš„æ¥å£æ–‡æ¡£é€šå¸¸æ˜¯æœ‰å¼€å‘äººå‘˜æ¥ç¼–å†™

6. æ€ä¹ˆè®¾è®¡æ¥å£

  > æ ¸å¿ƒæ˜¯è¦ç¡®å®šè¯·æ±‚å‚æ•°å’Œè¯·æ±‚è¿”å›å€¼

  - è¯·æ±‚å‚æ•°: ä¾æ®SQLä¸­çš„æ¡ä»¶(å‚æ•°)
  - è¯·æ±‚è¿”å›å€¼: ä¾æ®åŸå‹å›¾(åŸå‹å›¾ä¸Šè¦å±•ç¤ºä»€ä¹ˆæˆ‘ä»¬å°±è¿”å›ä»€ä¹ˆ)
  - è¯·æ±‚åœ°å€: è‡ªå·±å®šä¹‰
  - è¯·æ±‚æ–¹å¼: éµå¾ªRestFulçš„ç¼–ç¨‹é£æ ¼



#### ä¼ ç»Ÿçš„æ–‡æ¡£

1. word
2. markdown
3. pdf(å¯¹å…¬)



#### åœ¨çº¿ç¼–è¾‘å¹³å°

- YAPI



#### Swaggeræ¡†æ¶

1. å¯¼å…¥ä¾èµ–

```xml
<dependency>
	<groupId>com.github.xiaoymin</groupId>
	<artifactId>knife4j-spring-boot-starter</artifactId>
	<version>2.0.5</version>
</dependency>
```

2. å†™å…¥é…ç½®ç±»

```java
@Configuration
@EnableSwagger2
@EnableKnife4j
public class SwaggerConfig {
	@Bean
	public Docket createRestApi() {
	// æ–‡æ¡£ç±»å‹
		return new Docket(DocumentationType.SWAGGER_2)
			.apiInfo(apiInfo())
			.select()
			/* æ¥å£åŒ…æ‰€åœ¨çš„è·¯å¾„ ä¹Ÿå°±æ˜¯ä½ çš„ControlleråŒ… */
			.apis(RequestHandlerSelectors.basePackage("com.itheima.controller"))
			.paths(PathSelectors.any())
			.build();
	}
	/* å½“å‰è¿™ä¸ªæ¥å£æ–‡æ¡£çš„ä¿¡æ¯ */
	private ApiInfo apiInfo() {
		return new ApiInfoBuilder()
			.title("ç‘å‰å¤–å–")
			.version("1.0")
			.description("ç‘å‰å¤–å–æ¥å£æ–‡æ¡£")
			.build();
	}
}
```

3. åœ¨Controllerä¸­ä½¿ç”¨

```java
@RestController
@RequestMapping("dish")
@Api("èœå“ç›¸å…³çš„æ¥å£")
public class DishController {
	@Autowired
	private DishService dishService;
    
    /**
    * æ–°å¢èœå“çš„æ¥å£
    *
    * @param dish
    * @return
    * @throws IOException
    */
    @PostMapping
    @ApiOperation("æ–°å¢ä¸€ä¸ªèœå“")
    /*@ApiImplicitParams({
    @ApiImplicitParam(name = "page",value = "é¡µç ",required = true),
    @ApiImplicitParam(name = "pageSize",value = "æ¯é¡µè®°å½•æ•°",required = true),
    @ApiImplicitParam(name = "name",value = "å¥—é¤åç§°",required = false)})*/
    @ApiImplicitParam(name = "dish",value = "æ–°å¢èœå“æ•°æ®å°è£…å¯¹è±¡",required = true)
    public R saveDish(@RequestBody Dish dish) throws IOException {
        return dishService.saveDish(dish);
    }
}
```

4. åœ¨å®ä½“ç±»ä¸­ä½¿ç”¨

```java
@Data
@ApiModel("è¿”å›ç»™å‰å°çš„æ•°æ®å¯¹è±¡")
public class R<T> {
	//ç¼–ç ï¼š1æˆåŠŸï¼Œ0å’Œå…¶å®ƒæ•°å­—ä¸ºå¤±è´¥
	@ApiModelProperty("è‡ªå®šä¹‰çŠ¶æ€ç ")
	private Integer code;
	//é”™è¯¯ä¿¡æ¯
    @ApiModelProperty("è‡ªå®šä¹‰çŠ¶æ€ç æè¿°ä¿¡æ¯")
	private String msg;
	//æ•°æ®
	@ApiModelProperty("å“åº”ä½“æ•°æ®")
	private T data;
	//åŠ¨æ€æ•°æ®
	@ApiModelProperty("æ‰©å±•æ•°æ®")
	private Map map = new HashMap();
    public static <T> R<T> success(T object) {
        R<T> r = new R<T>();
        r.data = object;
        r.code = 1;
        return r;
    }
    public static <T> R<T> error(String msg) {
        R r = new R();
        r.msg = msg;
        r.code = 0;
        return r;
    }
    public R<T> add(String key, Object value) {
        this.map.put(key, value);
        return this;
    }
}
```

> è®¿é—®åœ°å€: http://localhost:ç«¯å£/doc.html



#### APIFoxå’ŒAPIPost

> Postman + Swagger + Mock + JMeter



### MySQLçš„ä¸»ä»

> ä½¿ç”¨ä¸»ä»æœåŠ¡å™¨å¯ä»¥åšåˆ°è¯»å†™åˆ†ç¦»
>
> å¯ä»¥è®©è¯»æ“ä½œèµ°ä¸“é—¨çš„æŸ¥è¯¢æœåŠ¡å™¨å¯ä»¥æé«˜æŸ¥è¯¢çš„å¹¶å‘æ•°

1. å¼•å…¥ä¾èµ–

```xml
<dependency>
	<groupId>org.apache.shardingsphere</groupId>
	<artifactId>sharding-jdbc-spring-boot-starter</artifactId>
	<version>4.0.0-RC1</version>
</dependency>
```

2. pom.xml

```properties
spring:
    shardingsphere:
        datasource:
            names: # å¦‚æœä½ æœ‰å¤šä¸ªæ•°æ®åº“ç”¨ names å¤šä¸ªæ•°æ®åº“ä¹‹é—´ç”¨é€—å·åˆ†å‰²
                master,slave # è¿™ä¸¤ä¸ªåç§°å¯ä»¥éšä¾¿å®šä¹‰
            master:
                type: com.alibaba.druid.pool.DruidDataSource
                driver-class-name: com.mysql.cj.jdbc.Driver
                url: jdbc:mysql://192.168.200.128:3307/rw?characterEncoding=utf-8
                username: root
                password: root
            slave:
                type: com.alibaba.druid.pool.DruidDataSource
                driver-class-name: com.mysql.cj.jdbc.Driver
                url: jdbc:mysql://192.168.200.128:3308/rw?characterEncoding=utf-8
                username: root
                password: root
        masterslave:
            # å¦‚æœæœ‰å¤šä¸ªä»æœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡ç­–ç•¥
            # ROUND_ROBIN(è½®è¯¢)ï¼ŒRANDOMï¼ˆéšæœºï¼‰
            load-balance-algorithm-type: round_robin #è½®è¯¢
            # æ•°æ®æºåç§° è¿™ä¸ªåç§°å¯ä»¥éšä¾¿å†™
            name: dataSource
            # ä¸»åº“æ•°æ®æºåç§°
            master-data-source-name: master
            # ä»åº“æ•°æ®æºåç§°åˆ—è¡¨ï¼Œå¤šä¸ªé€—å·åˆ†éš”
            slave-data-source-names: slave
        props:
            sql:
                show: true #å¼€å¯SQLæ˜¾ç¤ºï¼Œé»˜è®¤false
    main:
        allow-bean-definition-overriding: true # åé¢åˆ›å»ºçš„Beanå…è®¸è¦†ç›–å‰é¢å·²ç»åˆ›å»ºçš„Bean
```



### Nginx

> Nginxæ˜¯ä¸€ä¸ªé™æ€èµ„æºæœåŠ¡å™¨
>
> Nginxè¿˜å¯ä»¥ä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨
>
> å¯ä»¥ä¸ºWEBæœåŠ¡å™¨åšèµ„æºè½¬å‘



â—â—â—æ¯æ¬¡ä¿®æ”¹å®Œæ–‡ä»¶åè¦é‡æ–°åŠ è½½é…ç½®`nginx.exe -s reload`



- æ­£å‘ä»£ç†ï¼šç”¨æˆ·è®¿é—®æŸä¸ªç½‘ç«™ï¼Œä¸æ˜¯ç›´æ¥è®¿é—®ï¼Œ è€Œæ˜¯é€šè¿‡ä»£ç†è½¯ä»¶æ›¿ç”¨æˆ·è®¿é—®ï¼Œä»£ç†çš„ç›®æ ‡å¯¹è±¡æ˜¯==ç”¨æˆ·==
- åå‘ä»£ç†ï¼šç”¨æˆ·è®¿é—®æŸä¸ªç½‘ç«™ï¼Œä¸æ˜¯ç›´æ¥è®¿é—®ï¼Œè€Œæ˜¯é€šè¿‡ä»£ç†è½¯ä»¶æ‰¾åˆ°webæœåŠ¡å™¨ï¼Œä»£ç†çš„ç›®æ ‡å¯¹è±¡æ˜¯==æœåŠ¡å™¨(ç½‘ç«™)==
- è·¯ç”±è½¬å‘ï¼šæµè§ˆå™¨å‘é€è¯·æ±‚ï¼Œåœ¨Nginxä¸­æ¥æ”¶è¿™æ¬¡è¯·æ±‚å¹¶ä¸”è½¬å‘ç»™WEBæœåŠ¡å™¨



#### Nginxé…ç½®æ–‡ä»¶

- é€šè¿‡ proxy_pass å¯ä»¥å®ç°åå‘ä»£ç†
- é€šè¿‡ rewrite å¯ä»¥å®ç°è·¯ç”±è½¬å‘

```apl
# springbootsè¿™é‡Œå¯ä»¥éšä¾¿å†™
upstream springboots {
# Nginxåœ¨è¿™ä¸¤ä¸ªæœåŠ¡å™¨ä¹‹é—´å®ç°è´Ÿè½½å‡è¡¡ï¼ˆè½®è¯¢ï¼‰
	server 127.0.0.1:8081;
	server 127.0.0.1:8082;
}

# ä¸€ä¸ªServerä»£è¡¨ä¸€ä¸ªç«™ç‚¹ ä¸€ä¸ªNginxå¯ä»¥åšå¤šä¸ªç«™ç‚¹çš„é…ç½®
server {
	listen       80; # å½“å‰ç«™ç‚¹ç›‘å¬çš„æ¥å£
    server_name  localhost; # å½“å‰ç«™ç‚¹çš„åŸŸå

	#charset koi8-r;
	#access_log  logs/host.access.log  main;
	
	location /user {
		proxy_pass http://springboots; # åå‘ä»£ç† æœ¬èº«è‡ªå¸¦è´Ÿè½½å‡è¡¡
	}

	# ä¸€ä¸ªç«™ç‚¹ä¸­å¯ä»¥æœ‰å¤šä¸ªlocationï¼Œ ä¸€ä¸ªlocationä»£è¡¨ä¸€ç±»èµ„æºçš„ç›®å½•é…ç½®
	location / {
    	root   html; # é™æ€èµ„æºæ ¹ç›®å½•
        index  index.html index.htm; # é»˜è®¤è®¿é—®çš„èµ„æºåç§°
        }

	#error_page  404              /404.html;

	# redirect server error pages to the static page /50x.html
    #
    error_page   500 502 503 504  /50x.html; # æŠ¥é”™çš„é¡µé¢
    location = /50x.html {
    rewrite ^(/50x.html).*$ /hexo/public/index.html last; # è·¯ç”±è½¬å‘
    }
}
```



### é¡¹ç›®éƒ¨ç½²æµç¨‹

![é¡¹ç›®éƒ¨ç½²æµç¨‹](README/image-20220929171615155.png)

1. åœ¨Linuxä¸Šå¯åŠ¨ä¸¤ä¸ªMySQLæœåŠ¡å™¨(docker) 
2. åœ¨Linuxä¸Šå¯åŠ¨Redis
3. åœ¨Linuxä¸Šå¯åŠ¨Nginx 
4. ä¿®æ”¹ç‘å‰é¡¹ç›®ä¸­çš„é…ç½®æ–‡ä»¶ 
   1. ä¿®æ”¹MySQLçš„ä¸»ä»è¯»å†™åˆ†ç¦» 
   2. ä¿®æ”¹Redisçš„åœ°å€ 
5. å°†é™æ€èµ„æºä¸Šä¼ åˆ°Linuxå¹¶é…ç½®Nginxçš„é™æ€èµ„æºåœ°å€ 
6. é…ç½®Nginxä¸­çš„è·¯ç”±è½¬å‘åœ°å€ 
7. æŠŠç‘å‰é¡¹ç›®æ‰“æˆjaråŒ…ä¸Šä¼ åˆ°LinuxæœåŠ¡å™¨ 
8. å¯åŠ¨ç‘å‰é¡¹ç›®
9. è®¿é—®Nginxä¸­çš„é™æ€èµ„æº
